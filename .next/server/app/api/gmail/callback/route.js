"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/gmail/callback/route";
exports.ids = ["app/api/gmail/callback/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fgmail%2Fcallback%2Froute&page=%2Fapi%2Fgmail%2Fcallback%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fgmail%2Fcallback%2Froute.ts&appDir=C%3A%5CUsers%5CEmmanuel%5CDesktop%5CExpense%20Tracker%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CEmmanuel%5CDesktop%5CExpense%20Tracker&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fgmail%2Fcallback%2Froute&page=%2Fapi%2Fgmail%2Fcallback%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fgmail%2Fcallback%2Froute.ts&appDir=C%3A%5CUsers%5CEmmanuel%5CDesktop%5CExpense%20Tracker%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CEmmanuel%5CDesktop%5CExpense%20Tracker&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   headerHooks: () => (/* binding */ headerHooks),\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage),\n/* harmony export */   staticGenerationBailout: () => (/* binding */ staticGenerationBailout)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_Emmanuel_Desktop_Expense_Tracker_src_app_api_gmail_callback_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/gmail/callback/route.ts */ \"(rsc)/./src/app/api/gmail/callback/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/gmail/callback/route\",\n        pathname: \"/api/gmail/callback\",\n        filename: \"route\",\n        bundlePath: \"app/api/gmail/callback/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\Emmanuel\\\\Desktop\\\\Expense Tracker\\\\src\\\\app\\\\api\\\\gmail\\\\callback\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Users_Emmanuel_Desktop_Expense_Tracker_src_app_api_gmail_callback_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks, headerHooks, staticGenerationBailout } = routeModule;\nconst originalPathname = \"/api/gmail/callback/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZnbWFpbCUyRmNhbGxiYWNrJTJGcm91dGUmcGFnZT0lMkZhcGklMkZnbWFpbCUyRmNhbGxiYWNrJTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGZ21haWwlMkZjYWxsYmFjayUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNFbW1hbnVlbCU1Q0Rlc2t0b3AlNUNFeHBlbnNlJTIwVHJhY2tlciU1Q3NyYyU1Q2FwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9QyUzQSU1Q1VzZXJzJTVDRW1tYW51ZWwlNUNEZXNrdG9wJTVDRXhwZW5zZSUyMFRyYWNrZXImaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDdUM7QUFDcEg7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSx1R0FBdUc7QUFDL0c7QUFDQTtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUM2Sjs7QUFFN0oiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9leHBlbnNlLXRyYWNrZXIvP2VhNWEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiQzpcXFxcVXNlcnNcXFxcRW1tYW51ZWxcXFxcRGVza3RvcFxcXFxFeHBlbnNlIFRyYWNrZXJcXFxcc3JjXFxcXGFwcFxcXFxhcGlcXFxcZ21haWxcXFxcY2FsbGJhY2tcXFxccm91dGUudHNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwiXCJcbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IEFwcFJvdXRlUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2dtYWlsL2NhbGxiYWNrL3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvZ21haWwvY2FsbGJhY2tcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL2dtYWlsL2NhbGxiYWNrL3JvdXRlXCJcbiAgICB9LFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiQzpcXFxcVXNlcnNcXFxcRW1tYW51ZWxcXFxcRGVza3RvcFxcXFxFeHBlbnNlIFRyYWNrZXJcXFxcc3JjXFxcXGFwcFxcXFxhcGlcXFxcZ21haWxcXFxcY2FsbGJhY2tcXFxccm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgaGVhZGVySG9va3MsIHN0YXRpY0dlbmVyYXRpb25CYWlsb3V0IH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvZ21haWwvY2FsbGJhY2svcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgaGVhZGVySG9va3MsIHN0YXRpY0dlbmVyYXRpb25CYWlsb3V0LCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fgmail%2Fcallback%2Froute&page=%2Fapi%2Fgmail%2Fcallback%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fgmail%2Fcallback%2Froute.ts&appDir=C%3A%5CUsers%5CEmmanuel%5CDesktop%5CExpense%20Tracker%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CEmmanuel%5CDesktop%5CExpense%20Tracker&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/gmail/callback/route.ts":
/*!*********************************************!*\
  !*** ./src/app/api/gmail/callback/route.ts ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/web/exports/next-response */ \"(rsc)/./node_modules/next/dist/server/web/exports/next-response.js\");\n/* harmony import */ var _lib_supabaseServer__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/supabaseServer */ \"(rsc)/./src/lib/supabaseServer.ts\");\n/* harmony import */ var _lib_gmailCrypto__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/gmailCrypto */ \"(rsc)/./src/lib/gmailCrypto.ts\");\n\n\n\nasync function GET(request) {\n    const url = new URL(request.url);\n    const code = url.searchParams.get(\"code\");\n    const state = url.searchParams.get(\"state\");\n    if (!code || !state) {\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            error: \"Missing code or state\"\n        }, {\n            status: 400\n        });\n    }\n    const clientId = process.env.GOOGLE_OAUTH_CLIENT_ID;\n    const clientSecret = process.env.GOOGLE_OAUTH_CLIENT_SECRET;\n    const redirectUri = process.env.GOOGLE_OAUTH_REDIRECT_URI;\n    if (!clientId || !clientSecret || !redirectUri) {\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            error: \"Gmail OAuth env vars are not set\"\n        }, {\n            status: 500\n        });\n    }\n    const tokenParams = new URLSearchParams({\n        code,\n        client_id: clientId,\n        client_secret: clientSecret,\n        redirect_uri: redirectUri,\n        grant_type: \"authorization_code\"\n    });\n    const tokenRes = await fetch(\"https://oauth2.googleapis.com/token\", {\n        method: \"POST\",\n        headers: {\n            \"content-type\": \"application/x-www-form-urlencoded\"\n        },\n        body: tokenParams.toString()\n    });\n    if (!tokenRes.ok) {\n        const errorText = await tokenRes.text();\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            error: \"Failed to exchange code\",\n            details: errorText\n        }, {\n            status: 500\n        });\n    }\n    const tokenJson = await tokenRes.json();\n    const now = Date.now();\n    const expiresInMs = (tokenJson.expires_in ?? 3600) * 1000;\n    const expiryDate = new Date(now + expiresInMs).toISOString();\n    const userId = state;\n    const { data: existing } = await _lib_supabaseServer__WEBPACK_IMPORTED_MODULE_1__.supabaseServer.from(\"gmail_tokens\").select(\"id\").eq(\"user_id\", userId).maybeSingle();\n    const payload = {\n        user_id: userId,\n        access_token: (0,_lib_gmailCrypto__WEBPACK_IMPORTED_MODULE_2__.encryptToken)(tokenJson.access_token),\n        refresh_token: tokenJson.refresh_token ? (0,_lib_gmailCrypto__WEBPACK_IMPORTED_MODULE_2__.encryptToken)(tokenJson.refresh_token) : null,\n        expiry_date: expiryDate\n    };\n    let error = null;\n    if (existing) {\n        ({ error } = await _lib_supabaseServer__WEBPACK_IMPORTED_MODULE_1__.supabaseServer.from(\"gmail_tokens\").update(payload).eq(\"id\", existing.id));\n    } else {\n        ({ error } = await _lib_supabaseServer__WEBPACK_IMPORTED_MODULE_1__.supabaseServer.from(\"gmail_tokens\").insert(payload));\n    }\n    if (error) {\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            error: error.message\n        }, {\n            status: 500\n        });\n    }\n    // Also upsert into the generic mail_accounts table so settings can show\n    // all connected mail accounts (provider/email).\n    let emailAddress = null;\n    try {\n        const profileRes = await fetch(\"https://gmail.googleapis.com/gmail/v1/users/me/profile\", {\n            headers: {\n                Authorization: `Bearer ${tokenJson.access_token}`\n            }\n        });\n        if (profileRes.ok) {\n            const profileJson = await profileRes.json();\n            if (profileJson.emailAddress) {\n                emailAddress = profileJson.emailAddress;\n            }\n        }\n    } catch  {\n    // Ignore profile errors; we can still store the account without email.\n    }\n    const accountPayload = {\n        user_id: userId,\n        provider: \"gmail\",\n        email: emailAddress,\n        access_token: (0,_lib_gmailCrypto__WEBPACK_IMPORTED_MODULE_2__.encryptToken)(tokenJson.access_token),\n        refresh_token: tokenJson.refresh_token ? (0,_lib_gmailCrypto__WEBPACK_IMPORTED_MODULE_2__.encryptToken)(tokenJson.refresh_token) : null,\n        expiry_date: expiryDate\n    };\n    const { data: existingAccount } = await _lib_supabaseServer__WEBPACK_IMPORTED_MODULE_1__.supabaseServer.from(\"mail_accounts\").select(\"id\").eq(\"user_id\", userId).eq(\"provider\", \"gmail\").eq(\"email\", emailAddress).maybeSingle();\n    if (existingAccount) {\n        const { error: mailError } = await _lib_supabaseServer__WEBPACK_IMPORTED_MODULE_1__.supabaseServer.from(\"mail_accounts\").update(accountPayload).eq(\"id\", existingAccount.id);\n        if (mailError) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: mailError.message\n            }, {\n                status: 500\n            });\n        }\n    } else {\n        const { error: mailError } = await _lib_supabaseServer__WEBPACK_IMPORTED_MODULE_1__.supabaseServer.from(\"mail_accounts\").insert(accountPayload);\n        if (mailError) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: mailError.message\n            }, {\n                status: 500\n            });\n        }\n    }\n    const appUrl = \"http://localhost:3000\" || 0;\n    return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].redirect(`${appUrl}/settings?gmail=connected`);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9nbWFpbC9jYWxsYmFjay9yb3V0ZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQXdEO0FBQ0Y7QUFDTDtBQUUxQyxlQUFlRyxJQUFJQyxPQUFvQjtJQUM1QyxNQUFNQyxNQUFNLElBQUlDLElBQUlGLFFBQVFDLEdBQUc7SUFDL0IsTUFBTUUsT0FBT0YsSUFBSUcsWUFBWSxDQUFDQyxHQUFHLENBQUM7SUFDbEMsTUFBTUMsUUFBUUwsSUFBSUcsWUFBWSxDQUFDQyxHQUFHLENBQUM7SUFFbkMsSUFBSSxDQUFDRixRQUFRLENBQUNHLE9BQU87UUFDbkIsT0FBT1Ysa0ZBQVlBLENBQUNXLElBQUksQ0FBQztZQUFFQyxPQUFPO1FBQXdCLEdBQUc7WUFBRUMsUUFBUTtRQUFJO0lBQzdFO0lBRUEsTUFBTUMsV0FBV0MsUUFBUUMsR0FBRyxDQUFDQyxzQkFBc0I7SUFDbkQsTUFBTUMsZUFBZUgsUUFBUUMsR0FBRyxDQUFDRywwQkFBMEI7SUFDM0QsTUFBTUMsY0FBY0wsUUFBUUMsR0FBRyxDQUFDSyx5QkFBeUI7SUFFekQsSUFBSSxDQUFDUCxZQUFZLENBQUNJLGdCQUFnQixDQUFDRSxhQUFhO1FBQzlDLE9BQU9wQixrRkFBWUEsQ0FBQ1csSUFBSSxDQUFDO1lBQUVDLE9BQU87UUFBbUMsR0FBRztZQUFFQyxRQUFRO1FBQUk7SUFDeEY7SUFFQSxNQUFNUyxjQUFjLElBQUlDLGdCQUFnQjtRQUN0Q2hCO1FBQ0FpQixXQUFXVjtRQUNYVyxlQUFlUDtRQUNmUSxjQUFjTjtRQUNkTyxZQUFZO0lBQ2Q7SUFFQSxNQUFNQyxXQUFXLE1BQU1DLE1BQU0sdUNBQXVDO1FBQ2xFQyxRQUFRO1FBQ1JDLFNBQVM7WUFBRSxnQkFBZ0I7UUFBb0M7UUFDL0RDLE1BQU1WLFlBQVlXLFFBQVE7SUFDNUI7SUFFQSxJQUFJLENBQUNMLFNBQVNNLEVBQUUsRUFBRTtRQUNoQixNQUFNQyxZQUFZLE1BQU1QLFNBQVNRLElBQUk7UUFDckMsT0FBT3BDLGtGQUFZQSxD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QU87UUFDTCxNQUFNLEVBQUVELE9BQU95RCxTQUFTLEVBQUUsR0FBRyxNQUFNcEUsK0RBQWNBLENBQzlDK0MsSUFBSSxDQUFDLGlCQUNMVyxNQUFNLENBQUNNO1FBQ1YsSUFBSUksV0FBVztZQUNiLE9BQU9yRSxrRkFBWUEsQ0FBQ1csSUFBSSxDQUFDO2dCQUFFQyxPQUFPeUQsVUFBVVQsT0FBTztZQUFDLEdBQUc7Z0JBQUUvQyxRQUFRO1lBQUk7UUFDdkU7SUFDRjtJQUVBLE1BQU15RCxTQUFTdkQsdUJBQStCLElBQUksQ0FBdUI7SUFDekUsT0FBT2Ysa0ZBQVlBLENBQUN3RSxRQUFRLENBQUMsQ0FBQyxFQUFFRixPQUFPLHlCQUF5QixDQUFDO0FBQ25FIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZXhwZW5zZS10cmFja2VyLy4vc3JjL2FwcC9hcGkvZ21haWwvY2FsbGJhY2svcm91dGUudHM/YjQ1ZSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSBcIm5leHQvc2VydmVyXCI7XHJcbmltcG9ydCB7IHN1cGFiYXNlU2VydmVyIH0gZnJvbSBcIkAvbGliL3N1cGFiYXNlU2VydmVyXCI7XHJcbmltcG9ydCB7IGVuY3J5cHRUb2tlbiB9IGZyb20gXCJAL2xpYi9nbWFpbENyeXB0b1wiO1xyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIEdFVChyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xyXG4gIGNvbnN0IHVybCA9IG5ldyBVUkwocmVxdWVzdC51cmwpO1xyXG4gIGNvbnN0IGNvZGUgPSB1cmwuc2VhcmNoUGFyYW1zLmdldChcImNvZGVcIik7XHJcbiAgY29uc3Qgc3RhdGUgPSB1cmwuc2VhcmNoUGFyYW1zLmdldChcInN0YXRlXCIpO1xyXG5cclxuICBpZiAoIWNvZGUgfHwgIXN0YXRlKSB7XHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogXCJNaXNzaW5nIGNvZGUgb3Igc3RhdGVcIiB9LCB7IHN0YXR1czogNDAwIH0pO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgY2xpZW50SWQgPSBwcm9jZXNzLmVudi5HT09HTEVfT0FVVEhfQ0xJRU5UX0lEO1xyXG4gIGNvbnN0IGNsaWVudFNlY3JldCA9IHByb2Nlc3MuZW52LkdPT0dMRV9PQVVUSF9DTElFTlRfU0VDUkVUO1xyXG4gIGNvbnN0IHJlZGlyZWN0VXJpID0gcHJvY2Vzcy5lbnYuR09PR0xFX09BVVRIX1JFRElSRUNUX1VSSTtcclxuXHJcbiAgaWYgKCFjbGllbnRJZCB8fCAhY2xpZW50U2VjcmV0IHx8ICFyZWRpcmVjdFVyaSkge1xyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IFwiR21haWwgT0F1dGggZW52IHZhcnMgYXJlIG5vdCBzZXRcIiB9LCB7IHN0YXR1czogNTAwIH0pO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgdG9rZW5QYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHtcclxuICAgIGNvZGUsXHJcbiAgICBjbGllbnRfaWQ6IGNsaWVudElkLFxyXG4gICAgY2xpZW50X3NlY3JldDogY2xpZW50U2VjcmV0LFxyXG4gICAgcmVkaXJlY3RfdXJpOiByZWRpcmVjdFVyaSxcclxuICAgIGdyYW50X3R5cGU6IFwiYXV0aG9yaXphdGlvbl9jb2RlXCJcclxuICB9KTtcclxuXHJcbiAgY29uc3QgdG9rZW5SZXMgPSBhd2FpdCBmZXRjaChcImh0dHBzOi8vb2F1dGgyLmdvb2dsZWFwaXMuY29tL3Rva2VuXCIsIHtcclxuICAgIG1ldGhvZDogXCJQT1NUXCIsXHJcbiAgICBoZWFkZXJzOiB7IFwiY29udGVudC10eXBlXCI6IFwiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkXCIgfSxcclxuICAgIGJvZHk6IHRva2VuUGFyYW1zLnRvU3RyaW5nKClcclxuICB9KTtcclxuXHJcbiAgaWYgKCF0b2tlblJlcy5vaykge1xyXG4gICAgY29uc3QgZXJyb3JUZXh0ID0gYXdhaXQgdG9rZW5SZXMudGV4dCgpO1xyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IFwiRmFpbGVkIHRvIGV4Y2hhbmdlIGNvZGVcIiwgZGV0YWlsczogZXJyb3JUZXh0IH0sIHsgc3RhdHVzOiA1MDAgfSk7XHJcbiAgfVxyXG5cclxuICBjb25zdCB0b2tlbkpzb24gPSAoYXdhaXQgdG9rZW5SZXMuanNvbigpKSBhcyB7XHJcbiAgICBhY2Nlc3NfdG9rZW46IHN0cmluZztcclxuICAgIHJlZnJlc2hfdG9rZW4/OiBzdHJpbmc7XHJcbiAgICBleHBpcmVzX2luPzogbnVtYmVyO1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XHJcbiAgY29uc3QgZXhwaXJlc0luTXMgPSAodG9rZW5Kc29uLmV4cGlyZXNfaW4gPz8gMzYwMCkgKiAxMDAwO1xyXG4gIGNvbnN0IGV4cGlyeURhdGUgPSBuZXcgRGF0ZShub3cgKyBleHBpcmVzSW5NcykudG9JU09TdHJpbmcoKTtcclxuXHJcbiAgY29uc3QgdXNlcklkID0gc3RhdGU7XHJcblxyXG4gIGNvbnN0IHsgZGF0YTogZXhpc3RpbmcgfSA9IGF3YWl0IHN1cGFiYXNlU2VydmVyXHJcbiAgICAuZnJvbShcImdtYWlsX3Rva2Vuc1wiKVxyXG4gICAgLnNlbGVjdChcImlkXCIpXHJcbiAgICAuZXEoXCJ1c2VyX2lkXCIsIHVzZXJJZClcclxuICAgIC5tYXliZVNpbmdsZSgpO1xyXG5cclxuICBjb25zdCBwYXlsb2FkID0ge1xyXG4gICAgdXNlcl9pZDogdXNlcklkLFxyXG4gICAgYWNjZXNzX3Rva2VuOiBlbmNyeXB0VG9rZW4odG9rZW5Kc29uLmFjY2Vzc190b2tlbiksXHJcbiAgICByZWZyZXNoX3Rva2VuOiB0b2tlbkpzb24ucmVmcmVzaF90b2tlbiA/IGVuY3J5cHRUb2tlbih0b2tlbkpzb24ucmVmcmVzaF90b2tlbikgOiBudWxsLFxyXG4gICAgZXhwaXJ5X2RhdGU6IGV4cGlyeURhdGVcclxuICB9O1xyXG5cclxuICBsZXQgZXJyb3IgPSBudWxsO1xyXG4gIGlmIChleGlzdGluZykge1xyXG4gICAgKHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlU2VydmVyXHJcbiAgICAgIC5mcm9tKFwiZ21haWxfdG9rZW5zXCIpXHJcbiAgICAgIC51cGRhdGUocGF5bG9hZClcclxuICAgICAgLmVxKFwiaWRcIiwgZXhpc3RpbmcuaWQpKTtcclxuICB9IGVsc2Uge1xyXG4gICAgKHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlU2VydmVyLmZyb20oXCJnbWFpbF90b2tlbnNcIikuaW5zZXJ0KHBheWxvYWQpKTtcclxuICB9XHJcblxyXG4gIGlmIChlcnJvcikge1xyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfSwgeyBzdGF0dXM6IDUwMCB9KTtcclxuICB9XHJcblxyXG4gIC8vIEFsc28gdXBzZXJ0IGludG8gdGhlIGdlbmVyaWMgbWFpbF9hY2NvdW50cyB0YWJsZSBzbyBzZXR0aW5ncyBjYW4gc2hvd1xyXG4gIC8vIGFsbCBjb25uZWN0ZWQgbWFpbCBhY2NvdW50cyAocHJvdmlkZXIvZW1haWwpLlxyXG4gIGxldCBlbWFpbEFkZHJlc3M6IHN0cmluZyB8IG51bGwgPSBudWxsO1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBwcm9maWxlUmVzID0gYXdhaXQgZmV0Y2goXHJcbiAgICAgIFwiaHR0cHM6Ly9nbWFpbC5nb29nbGVhcGlzLmNvbS9nbWFpbC92MS91c2Vycy9tZS9wcm9maWxlXCIsXHJcbiAgICAgIHtcclxuICAgICAgICBoZWFkZXJzOiB7IEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbkpzb24uYWNjZXNzX3Rva2VufWAgfVxyXG4gICAgICB9XHJcbiAgICApO1xyXG4gICAgaWYgKHByb2ZpbGVSZXMub2spIHtcclxuICAgICAgY29uc3QgcHJvZmlsZUpzb24gPSAoYXdhaXQgcHJvZmlsZVJlcy5qc29uKCkpIGFzIHtcclxuICAgICAgICBlbWFpbEFkZHJlc3M/OiBzdHJpbmc7XHJcbiAgICAgIH07XHJcbiAgICAgIGlmIChwcm9maWxlSnNvbi5lbWFpbEFkZHJlc3MpIHtcclxuICAgICAgICBlbWFpbEFkZHJlc3MgPSBwcm9maWxlSnNvbi5lbWFpbEFkZHJlc3M7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9IGNhdGNoIHtcclxuICAgIC8vIElnbm9yZSBwcm9maWxlIGVycm9yczsgd2UgY2FuIHN0aWxsIHN0b3JlIHRoZSBhY2NvdW50IHdpdGhvdXQgZW1haWwuXHJcbiAgfVxyXG5cclxuICBjb25zdCBhY2NvdW50UGF5bG9hZCA9IHtcclxuICAgIHVzZXJfaWQ6IHVzZXJJZCxcclxuICAgIHByb3ZpZGVyOiBcImdtYWlsXCIsXHJcbiAgICBlbWFpbDogZW1haWxBZGRyZXNzLFxyXG4gICAgYWNjZXNzX3Rva2VuOiBlbmNyeXB0VG9rZW4odG9rZW5Kc29uLmFjY2Vzc190b2tlbiksXHJcbiAgICByZWZyZXNoX3Rva2VuOiB0b2tlbkpzb24ucmVmcmVzaF90b2tlblxyXG4gICAgICA/IGVuY3J5cHRUb2tlbih0b2tlbkpzb24ucmVmcmVzaF90b2tlbilcclxuICAgICAgOiBudWxsLFxyXG4gICAgZXhwaXJ5X2RhdGU6IGV4cGlyeURhdGVcclxuICB9O1xyXG5cclxuICBjb25zdCB7IGRhdGE6IGV4aXN0aW5nQWNjb3VudCB9ID0gYXdhaXQgc3VwYWJhc2VTZXJ2ZXJcclxuICAgIC5mcm9tKFwibWFpbF9hY2NvdW50c1wiKVxyXG4gICAgLnNlbGVjdChcImlkXCIpXHJcbiAgICAuZXEoXCJ1c2VyX2lkXCIsIHVzZXJJZClcclxuICAgIC5lcShcInByb3ZpZGVyXCIsIFwiZ21haWxcIilcclxuICAgIC5lcShcImVtYWlsXCIsIGVtYWlsQWRkcmVzcylcclxuICAgIC5tYXliZVNpbmdsZSgpO1xyXG5cclxuICBpZiAoZXhpc3RpbmdBY2NvdW50KSB7XHJcbiAgICBjb25zdCB7IGVycm9yOiBtYWlsRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlU2VydmVyXHJcbiAgICAgIC5mcm9tKFwibWFpbF9hY2NvdW50c1wiKVxyXG4gICAgICAudXBkYXRlKGFjY291bnRQYXlsb2FkKVxyXG4gICAgICAuZXEoXCJpZFwiLCBleGlzdGluZ0FjY291bnQuaWQpO1xyXG4gICAgaWYgKG1haWxFcnJvcikge1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogbWFpbEVycm9yLm1lc3NhZ2UgfSwgeyBzdGF0dXM6IDUwMCB9KTtcclxuICAgIH1cclxuICB9IGVsc2Uge1xyXG4gICAgY29uc3QgeyBlcnJvcjogbWFpbEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVNlcnZlclxyXG4gICAgICAuZnJvbShcIm1haWxfYWNjb3VudHNcIilcclxuICAgICAgLmluc2VydChhY2NvdW50UGF5bG9hZCk7XHJcbiAgICBpZiAobWFpbEVycm9yKSB7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBtYWlsRXJyb3IubWVzc2FnZSB9LCB7IHN0YXR1czogNTAwIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgY29uc3QgYXBwVXJsID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfQVBQX1VSTCB8fCBcImh0dHA6Ly9sb2NhbGhvc3Q6MzAwMFwiO1xyXG4gIHJldHVybiBOZXh0UmVzcG9uc2UucmVkaXJlY3QoYCR7YXBwVXJsfS9zZXR0aW5ncz9nbWFpbD1jb25uZWN0ZWRgKTtcclxufVxyXG4iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwic3VwYWJhc2VTZXJ2ZXIiLCJlbmNyeXB0VG9rZW4iLCJHRVQiLCJyZXF1ZXN0IiwidXJsIiwiVVJMIiwiY29kZSIsInNlYXJjaFBhcmFtcyIsImdldCIsInN0YXRlIiwianNvbiIsImVycm9yIiwic3RhdHVzIiwiY2xpZW50SWQiLCJwcm9jZXNzIiwiZW52IiwiR09PR0xFX09BVVRIX0NMSUVOVF9JRCIsImNsaWVudFNlY3JldCIsIkdPT0dMRV9PQVVUSF9DTElFTlRfU0VDUkVUIiwicmVkaXJlY3RVcmkiLCJHT09HTEVfT0FVVEhfUkVESVJFQ1RfVVJJIiwidG9rZW5QYXJhbXMiLCJVUkxTZWFyY2hQYXJhbXMiLCJjbGllbnRfaWQiLCJjbGllbnRfc2VjcmV0IiwicmVkaXJlY3RfdXJpIiwiZ3JhbnRfdHlwZSIsInRva2VuUmVzIiwiZmV0Y2giLCJtZXRob2QiLCJoZWFkZXJzIiwiYm9keSIsInRvU3RyaW5nIiwib2siLCJlcnJvclRleHQiLCJ0ZXh0IiwiZGV0YWlscyIsInRva2VuSnNvbiIsIm5vdyIsIkRhdGUiLCJleHBpcmVzSW5NcyIsImV4cGlyZXNfaW4iLCJleHBpcnlEYXRlIiwidG9JU09TdHJpbmciLCJ1c2VySWQiLCJkYXRhIiwiZXhpc3RpbmciLCJmcm9tIiwic2VsZWN0IiwiZXEiLCJtYXliZVNpbmdsZSIsInBheWxvYWQiLCJ1c2VyX2lkIiwiYWNjZXNzX3Rva2VuIiwicmVmcmVzaF90b2tlbiIsImV4cGlyeV9kYXRlIiwidXBkYXRlIiwiaWQiLCJpbnNlcnQiLCJtZXNzYWdlIiwiZW1haWxBZGRyZXNzIiwicHJvZmlsZVJlcyIsIkF1dGhvcml6YXRpb24iLCJwcm9maWxlSnNvbiIsImFjY291bnRQYXlsb2FkIiwicHJvdmlkZXIiLCJlbWFpbCIsImV4aXN0aW5nQWNjb3VudCIsIm1haWxFcnJvciIsImFwcFVybCIsIk5FWFRfUFVCTElDX0FQUF9VUkwiLCJyZWRpcmVjdCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/gmail/callback/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/gmailCrypto.ts":
/*!********************************!*\
  !*** ./src/lib/gmailCrypto.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   decryptToken: () => (/* binding */ decryptToken),\n/* harmony export */   encryptToken: () => (/* binding */ encryptToken)\n/* harmony export */ });\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_0__);\n\nconst SECRET = process.env.GMAIL_ENCRYPTION_KEY;\nif (!SECRET) {\n    throw new Error(\"GMAIL_ENCRYPTION_KEY is not set\");\n}\nconst KEY = crypto__WEBPACK_IMPORTED_MODULE_0___default().createHash(\"sha256\").update(SECRET).digest();\nconst IV_LENGTH = 12; // AES-GCM recommended IV length\nfunction encryptToken(plain) {\n    const iv = crypto__WEBPACK_IMPORTED_MODULE_0___default().randomBytes(IV_LENGTH);\n    const cipher = crypto__WEBPACK_IMPORTED_MODULE_0___default().createCipheriv(\"aes-256-gcm\", KEY, iv);\n    const enc = Buffer.concat([\n        cipher.update(plain, \"utf8\"),\n        cipher.final()\n    ]);\n    const tag = cipher.getAuthTag();\n    return Buffer.concat([\n        iv,\n        tag,\n        enc\n    ]).toString(\"base64\");\n}\nfunction decryptToken(payload) {\n    const data = Buffer.from(payload, \"base64\");\n    const iv = data.subarray(0, IV_LENGTH);\n    const tag = data.subarray(IV_LENGTH, IV_LENGTH + 16);\n    const enc = data.subarray(IV_LENGTH + 16);\n    const decipher = crypto__WEBPACK_IMPORTED_MODULE_0___default().createDecipheriv(\"aes-256-gcm\", KEY, iv);\n    decipher.setAuthTag(tag);\n    const dec = Buffer.concat([\n        decipher.update(enc),\n        decipher.final()\n    ]);\n    return dec.toString(\"utf8\");\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2dtYWlsQ3J5cHRvLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBNEI7QUFFNUIsTUFBTUMsU0FBU0MsUUFBUUMsR0FBRyxDQUFDQyxvQkFBb0I7QUFFL0MsSUFBSSxDQUFDSCxRQUFRO0lBQ1gsTUFBTSxJQUFJSSxNQUFNO0FBQ2xCO0FBRUEsTUFBTUMsTUFBTU4sd0RBQWlCLENBQUMsVUFBVVEsTUFBTSxDQUFDUCxRQUFRUSxNQUFNO0FBQzdELE1BQU1DLFlBQVksSUFBSSxnQ0FBZ0M7QUFFL0MsU0FBU0MsYUFBYUMsS0FBYTtJQUN4QyxNQUFNQyxLQUFLYix5REFBa0IsQ0FBQ1U7SUFDOUIsTUFBTUssU0FBU2YsNERBQXFCLENBQUMsZUFBZU0sS0FBS087SUFDekQsTUFBTUksTUFBTUMsT0FBT0MsTUFBTSxDQUFDO1FBQUNKLE9BQU9QLE1BQU0sQ0FBQ0ksT0FBTztRQUFTRyxPQUFPSyxLQUFLO0tBQUc7SUFDeEUsTUFBTUMsTUFBTU4sT0FBT08sVUFBVTtJQUM3QixPQUFPSixPQUFPQyxNQUFNLENBQUM7UUFBQ047UUFBSVE7UUFBS0o7S0FBSSxFQUFFTSxRQUFRLENBQUM7QUFDaEQ7QUFFTyxTQUFTQyxhQUFhQyxPQUFlO0lBQzFDLE1BQU1DLE9BQU9SLE9BQU9TLElBQUksQ0FBQ0YsU0FBUztJQUNsQyxNQUFNWixLQUFLYSxLQUFLRSxRQUFRLENBQUMsR0FBR2xCO0lBQzVCLE1BQU1XLE1BQU1LLEtBQUtFLFFBQVEsQ0FBQ2xCLFdBQVdBLFlBQVk7SUFDakQsTUFBTU8sTUFBTVMsS0FBS0UsUUFBUSxDQUFDbEIsWUFBWTtJQUN0QyxNQUFNbUIsV0FBVzdCLDhEQUF1QixDQUFDLGVBQWVNLEtBQUtPO0lBQzdEZ0IsU0FBU0UsVUFBVSxDQUFDVjtJQUNwQixNQUFNVyxNQUFNZCxPQUFPQyxNQUFNLENBQUM7UUFBQ1UsU0FBU3JCLE1BQU0sQ0FBQ1M7UUFBTVksU0FBU1QsS0FBSztLQUFHO0lBQ2xFLE9BQU9ZLElBQUlULFFBQVEsQ0FBQztBQUN0QiIsInNvdXJjZXMiOlsid2VicGFjazovL2V4cGVuc2UtdHJhY2tlci8uL3NyYy9saWIvZ21haWxDcnlwdG8udHM/MmViYiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgY3J5cHRvIGZyb20gXCJjcnlwdG9cIjtcclxuXHJcbmNvbnN0IFNFQ1JFVCA9IHByb2Nlc3MuZW52LkdNQUlMX0VOQ1JZUFRJT05fS0VZO1xyXG5cclxuaWYgKCFTRUNSRVQpIHtcclxuICB0aHJvdyBuZXcgRXJyb3IoXCJHTUFJTF9FTkNSWVBUSU9OX0tFWSBpcyBub3Qgc2V0XCIpO1xyXG59XHJcblxyXG5jb25zdCBLRVkgPSBjcnlwdG8uY3JlYXRlSGFzaChcInNoYTI1NlwiKS51cGRhdGUoU0VDUkVUKS5kaWdlc3QoKTtcclxuY29uc3QgSVZfTEVOR1RIID0gMTI7IC8vIEFFUy1HQ00gcmVjb21tZW5kZWQgSVYgbGVuZ3RoXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZW5jcnlwdFRva2VuKHBsYWluOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gIGNvbnN0IGl2ID0gY3J5cHRvLnJhbmRvbUJ5dGVzKElWX0xFTkdUSCk7XHJcbiAgY29uc3QgY2lwaGVyID0gY3J5cHRvLmNyZWF0ZUNpcGhlcml2KFwiYWVzLTI1Ni1nY21cIiwgS0VZLCBpdik7XHJcbiAgY29uc3QgZW5jID0gQnVmZmVyLmNvbmNhdChbY2lwaGVyLnVwZGF0ZShwbGFpbiwgXCJ1dGY4XCIpLCBjaXBoZXIuZmluYWwoKV0pO1xyXG4gIGNvbnN0IHRhZyA9IGNpcGhlci5nZXRBdXRoVGFnKCk7XHJcbiAgcmV0dXJuIEJ1ZmZlci5jb25jYXQoW2l2LCB0YWcsIGVuY10pLnRvU3RyaW5nKFwiYmFzZTY0XCIpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZGVjcnlwdFRva2VuKHBheWxvYWQ6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgY29uc3QgZGF0YSA9IEJ1ZmZlci5mcm9tKHBheWxvYWQsIFwiYmFzZTY0XCIpO1xyXG4gIGNvbnN0IGl2ID0gZGF0YS5zdWJhcnJheSgwLCBJVl9MRU5HVEgpO1xyXG4gIGNvbnN0IHRhZyA9IGRhdGEuc3ViYXJyYXkoSVZfTEVOR1RILCBJVl9MRU5HVEggKyAxNik7XHJcbiAgY29uc3QgZW5jID0gZGF0YS5zdWJhcnJheShJVl9MRU5HVEggKyAxNik7XHJcbiAgY29uc3QgZGVjaXBoZXIgPSBjcnlwdG8uY3JlYXRlRGVjaXBoZXJpdihcImFlcy0yNTYtZ2NtXCIsIEtFWSwgaXYpO1xyXG4gIGRlY2lwaGVyLnNldEF1dGhUYWcodGFnKTtcclxuICBjb25zdCBkZWMgPSBCdWZmZXIuY29uY2F0KFtkZWNpcGhlci51cGRhdGUoZW5jKSwgZGVjaXBoZXIuZmluYWwoKV0pO1xyXG4gIHJldHVybiBkZWMudG9TdHJpbmcoXCJ1dGY4XCIpO1xyXG59XHJcbiJdLCJuYW1lcyI6WyJjcnlwdG8iLCJTRUNSRVQiLCJwcm9jZXNzIiwiZW52IiwiR01BSUxfRU5DUllQVElPTl9LRVkiLCJFcnJvciIsIktFWSIsImNyZWF0ZUhhc2giLCJ1cGRhdGUiLCJkaWdlc3QiLCJJVl9MRU5HVEgiLCJlbmNyeXB0VG9rZW4iLCJwbGFpbiIsIml2IiwicmFuZG9tQnl0ZXMiLCJjaXBoZXIiLCJjcmVhdGVDaXBoZXJpdiIsImVuYyIsIkJ1ZmZlciIsImNvbmNhdCIsImZpbmFsIiwidGFnIiwiZ2V0QXV0aFRhZyIsInRvU3RyaW5nIiwiZGVjcnlwdFRva2VuIiwicGF5bG9hZCIsImRhdGEiLCJmcm9tIiwic3ViYXJyYXkiLCJkZWNpcGhlciIsImNyZWF0ZURlY2lwaGVyaXYiLCJzZXRBdXRoVGFnIiwiZGVjIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/gmailCrypto.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/supabaseServer.ts":
/*!***********************************!*\
  !*** ./src/lib/supabaseServer.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   supabaseServer: () => (/* binding */ supabaseServer)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n\nconst supabaseUrl = \"https://eaunposkvqyszpnwwbrc.supabase.co\";\nconst serviceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\nif (!supabaseUrl || !serviceRoleKey) {\n    throw new Error(\"Supabase server env vars are not set\");\n}\nconst supabaseServer = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, serviceRoleKey, {\n    auth: {\n        autoRefreshToken: false,\n        persistSession: false\n    }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3N1cGFiYXNlU2VydmVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQXFEO0FBRXJELE1BQU1DLGNBQWNDLDBDQUFvQztBQUN4RCxNQUFNRyxpQkFBaUJILFFBQVFDLEdBQUcsQ0FBQ0cseUJBQXlCO0FBRTVELElBQUksQ0FBQ0wsZUFBZSxDQUFDSSxnQkFBZ0I7SUFDbkMsTUFBTSxJQUFJRSxNQUFNO0FBQ2xCO0FBRU8sTUFBTUMsaUJBQWlCUixtRUFBWUEsQ0FBQ0MsYUFBYUksZ0JBQWdCO0lBQ3RFSSxNQUFNO1FBQ0pDLGtCQUFrQjtRQUNsQkMsZ0JBQWdCO0lBQ2xCO0FBQ0YsR0FBRyIsInNvdXJjZXMiOlsid2VicGFjazovL2V4cGVuc2UtdHJhY2tlci8uL3NyYy9saWIvc3VwYWJhc2VTZXJ2ZXIudHM/MWIzMiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tIFwiQHN1cGFiYXNlL3N1cGFiYXNlLWpzXCI7XHJcblxyXG5jb25zdCBzdXBhYmFzZVVybCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCBhcyBzdHJpbmc7XHJcbmNvbnN0IHNlcnZpY2VSb2xlS2V5ID0gcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSBhcyBzdHJpbmc7XHJcblxyXG5pZiAoIXN1cGFiYXNlVXJsIHx8ICFzZXJ2aWNlUm9sZUtleSkge1xyXG4gIHRocm93IG5ldyBFcnJvcihcIlN1cGFiYXNlIHNlcnZlciBlbnYgdmFycyBhcmUgbm90IHNldFwiKTtcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IHN1cGFiYXNlU2VydmVyID0gY3JlYXRlQ2xpZW50KHN1cGFiYXNlVXJsLCBzZXJ2aWNlUm9sZUtleSwge1xyXG4gIGF1dGg6IHtcclxuICAgIGF1dG9SZWZyZXNoVG9rZW46IGZhbHNlLFxyXG4gICAgcGVyc2lzdFNlc3Npb246IGZhbHNlXHJcbiAgfVxyXG59KTtcclxuIl0sIm5hbWVzIjpbImNyZWF0ZUNsaWVudCIsInN1cGFiYXNlVXJsIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsInNlcnZpY2VSb2xlS2V5IiwiU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSIsIkVycm9yIiwic3VwYWJhc2VTZXJ2ZXIiLCJhdXRoIiwiYXV0b1JlZnJlc2hUb2tlbiIsInBlcnNpc3RTZXNzaW9uIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/supabaseServer.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@supabase","vendor-chunks/tslib"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fgmail%2Fcallback%2Froute&page=%2Fapi%2Fgmail%2Fcallback%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fgmail%2Fcallback%2Froute.ts&appDir=C%3A%5CUsers%5CEmmanuel%5CDesktop%5CExpense%20Tracker%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CEmmanuel%5CDesktop%5CExpense%20Tracker&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();