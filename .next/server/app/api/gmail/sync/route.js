"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/gmail/sync/route";
exports.ids = ["app/api/gmail/sync/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fgmail%2Fsync%2Froute&page=%2Fapi%2Fgmail%2Fsync%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fgmail%2Fsync%2Froute.ts&appDir=C%3A%5CUsers%5CEmmanuel%5CDesktop%5CExpense%20Tracker%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CEmmanuel%5CDesktop%5CExpense%20Tracker&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fgmail%2Fsync%2Froute&page=%2Fapi%2Fgmail%2Fsync%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fgmail%2Fsync%2Froute.ts&appDir=C%3A%5CUsers%5CEmmanuel%5CDesktop%5CExpense%20Tracker%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CEmmanuel%5CDesktop%5CExpense%20Tracker&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   headerHooks: () => (/* binding */ headerHooks),\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage),\n/* harmony export */   staticGenerationBailout: () => (/* binding */ staticGenerationBailout)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_Emmanuel_Desktop_Expense_Tracker_src_app_api_gmail_sync_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/gmail/sync/route.ts */ \"(rsc)/./src/app/api/gmail/sync/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/gmail/sync/route\",\n        pathname: \"/api/gmail/sync\",\n        filename: \"route\",\n        bundlePath: \"app/api/gmail/sync/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\Emmanuel\\\\Desktop\\\\Expense Tracker\\\\src\\\\app\\\\api\\\\gmail\\\\sync\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Users_Emmanuel_Desktop_Expense_Tracker_src_app_api_gmail_sync_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks, headerHooks, staticGenerationBailout } = routeModule;\nconst originalPathname = \"/api/gmail/sync/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZnbWFpbCUyRnN5bmMlMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRmdtYWlsJTJGc3luYyUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRmdtYWlsJTJGc3luYyUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNFbW1hbnVlbCU1Q0Rlc2t0b3AlNUNFeHBlbnNlJTIwVHJhY2tlciU1Q3NyYyU1Q2FwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9QyUzQSU1Q1VzZXJzJTVDRW1tYW51ZWwlNUNEZXNrdG9wJTVDRXhwZW5zZSUyMFRyYWNrZXImaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDbUM7QUFDaEg7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSx1R0FBdUc7QUFDL0c7QUFDQTtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUM2Sjs7QUFFN0oiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9leHBlbnNlLXRyYWNrZXIvPzljNWEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiQzpcXFxcVXNlcnNcXFxcRW1tYW51ZWxcXFxcRGVza3RvcFxcXFxFeHBlbnNlIFRyYWNrZXJcXFxcc3JjXFxcXGFwcFxcXFxhcGlcXFxcZ21haWxcXFxcc3luY1xcXFxyb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvZ21haWwvc3luYy9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2dtYWlsL3N5bmNcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL2dtYWlsL3N5bmMvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCJDOlxcXFxVc2Vyc1xcXFxFbW1hbnVlbFxcXFxEZXNrdG9wXFxcXEV4cGVuc2UgVHJhY2tlclxcXFxzcmNcXFxcYXBwXFxcXGFwaVxcXFxnbWFpbFxcXFxzeW5jXFxcXHJvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIGhlYWRlckhvb2tzLCBzdGF0aWNHZW5lcmF0aW9uQmFpbG91dCB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL2dtYWlsL3N5bmMvcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgaGVhZGVySG9va3MsIHN0YXRpY0dlbmVyYXRpb25CYWlsb3V0LCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fgmail%2Fsync%2Froute&page=%2Fapi%2Fgmail%2Fsync%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fgmail%2Fsync%2Froute.ts&appDir=C%3A%5CUsers%5CEmmanuel%5CDesktop%5CExpense%20Tracker%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CEmmanuel%5CDesktop%5CExpense%20Tracker&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/gmail/sync/route.ts":
/*!*****************************************!*\
  !*** ./src/app/api/gmail/sync/route.ts ***!
  \*****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   runtime: () => (/* binding */ runtime)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/web/exports/next-response */ \"(rsc)/./node_modules/next/dist/server/web/exports/next-response.js\");\n/* harmony import */ var _lib_supabaseServer__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/supabaseServer */ \"(rsc)/./src/lib/supabaseServer.ts\");\n/* harmony import */ var _lib_auth__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/auth */ \"(rsc)/./src/lib/auth.ts\");\n/* harmony import */ var _lib_gmailCrypto__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/gmailCrypto */ \"(rsc)/./src/lib/gmailCrypto.ts\");\n/* harmony import */ var _lib_parsing_transactionParser__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/lib/parsing/transactionParser */ \"(rsc)/./src/lib/parsing/transactionParser.ts\");\n/* harmony import */ var _lib_logging__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/lib/logging */ \"(rsc)/./src/lib/logging.ts\");\n/* harmony import */ var _lib_rulesEngine__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @/lib/rulesEngine */ \"(rsc)/./src/lib/rulesEngine.ts\");\n\n\n\n\n\n\n\nconst runtime = \"nodejs\";\nasync function ensureAccessToken(record) {\n    const clientId = process.env.GOOGLE_OAUTH_CLIENT_ID;\n    const clientSecret = process.env.GOOGLE_OAUTH_CLIENT_SECRET;\n    if (!clientId || !clientSecret) {\n        return {\n            error: \"Gmail OAuth env vars are not set\"\n        };\n    }\n    const now = Date.now();\n    const expiryMs = record.expiry_date ? new Date(record.expiry_date).getTime() : 0;\n    // If token not near expiry (60s buffer), just use it\n    if (expiryMs - now > 60 * 1000) {\n        return {\n            accessToken: (0,_lib_gmailCrypto__WEBPACK_IMPORTED_MODULE_3__.decryptToken)(record.access_token)\n        };\n    }\n    if (!record.refresh_token) {\n        return {\n            accessToken: (0,_lib_gmailCrypto__WEBPACK_IMPORTED_MODULE_3__.decryptToken)(record.access_token)\n        };\n    }\n    const refreshRes = await fetch(\"https://oauth2.googleapis.com/token\", {\n        method: \"POST\",\n        headers: {\n            \"content-type\": \"application/x-www-form-urlencoded\"\n        },\n        body: new URLSearchParams({\n            client_id: clientId,\n            client_secret: clientSecret,\n            grant_type: \"refresh_token\",\n            refresh_token: (0,_lib_gmailCrypto__WEBPACK_IMPORTED_MODULE_3__.decryptToken)(record.refresh_token)\n        }).toString()\n    });\n    if (!refreshRes.ok) {\n        const text = await refreshRes.text();\n        (0,_lib_logging__WEBPACK_IMPORTED_MODULE_5__.logParseError)(\"gmail\", \"Failed to refresh access token\", {\n            text\n        });\n        return {\n            error: \"Failed to refresh access token\"\n        };\n    }\n    const json = await refreshRes.json();\n    const newAccessToken = json.access_token;\n    const expiryDate = new Date(Date.now() + (json.expires_in ?? 3600) * 1000).toISOString();\n    const { error } = await _lib_supabaseServer__WEBPACK_IMPORTED_MODULE_1__.supabaseServer.from(\"gmail_tokens\").update({\n        access_token: (0,_lib_gmailCrypto__WEBPACK_IMPORTED_MODULE_3__.encryptToken)(newAccessToken),\n        expiry_date: expiryDate\n    }).eq(\"id\", record.id);\n    if (error) {\n        (0,_lib_logging__WEBPACK_IMPORTED_MODULE_5__.logParseError)(\"gmail\", \"Failed to update refreshed token in DB\", {\n            error: error.message\n        });\n    }\n    return {\n        accessToken: newAccessToken\n    };\n}\nfunction decodeBase64Url(data) {\n    const normalized = data.replace(/-/g, \"+\").replace(/_/g, \"/\");\n    const buff = Buffer.from(normalized, \"base64\");\n    return buff.toString(\"utf8\");\n}\nfunction decodeBase64UrlToBuffer(data) {\n    const normalized = data.replace(/-/g, \"+\").replace(/_/g, \"/\");\n    return Buffer.from(normalized, \"base64\");\n}\nfunction extractEmailText(message) {\n    const payload = message.payload;\n    const partsQueue = [\n        payload\n    ];\n    const texts = [];\n    while(partsQueue.length > 0){\n        const part = partsQueue.pop();\n        if (!part) continue;\n        if (part.mimeType === \"text/plain\" && part.body?.data) {\n            texts.push(decodeBase64Url(part.body.data));\n        } else if (part.mimeType === \"text/html\" && part.body?.data) {\n            const html = decodeBase64Url(part.body.data);\n            const text = html.replace(/<[^>]+>/g, \" \");\n            texts.push(text);\n        } else if (part.parts && Array.isArray(part.parts)) {\n            partsQueue.push(...part.parts);\n        }\n    }\n    if (texts.length === 0 && payload.body?.data) {\n        texts.push(decodeBase64Url(payload.body.data));\n    }\n    return texts.join(\"\\n\\n\");\n}\nasync function extractPdfData(userId, messageId, payload, accessToken) {\n    const texts = [];\n    const urls = [];\n    const partsQueue = [\n        payload\n    ];\n    while(partsQueue.length > 0){\n        const part = partsQueue.pop();\n        if (!part) continue;\n        const isPdfMime = part.mimeType === \"application/pdf\";\n        const rawFilename = typeof part.filename === \"string\" ? part.filename.trim() : \"\";\n        const isPdfFilename = rawFilename.toLowerCase().endsWith(\".pdf\");\n        (0,_lib_logging__WEBPACK_IMPORTED_MODULE_5__.logParseError)(\"gmail\", \"Inspecting MIME part\", {\n            messageId,\n            mimeType: part.mimeType,\n            filename: part.filename ?? null,\n            hasAttachmentId: !!part.body?.attachmentId,\n            isPdfMime,\n            isPdfFilename\n        });\n        if ((isPdfMime || isPdfFilename) && part.body?.attachmentId) {\n            try {\n                const pdfModule = await Promise.all(/*! import() */[__webpack_require__.e(\"vendor-chunks/pdf-parse\"), __webpack_require__.e(\"vendor-chunks/pdfjs-dist\")]).then(__webpack_require__.bind(__webpack_require__, /*! pdf-parse */ \"(rsc)/./node_modules/pdf-parse/dist/pdf-parse/esm/index.js\"));\n                const pdfParse = pdfModule.default || pdfModule;\n                const attachRes = await fetch(`https://gmail.googleapis.com/gmail/v1/users/me/messages/${messageId}/attachments/${part.body.attachmentId}`, {\n                    headers: {\n                        Authorization: `Bearer ${accessToken}`\n                    }\n                });\n                if (!attachRes.ok) {\n                    const text = await attachRes.text();\n                    (0,_lib_logging__WEBPACK_IMPORTED_MODULE_5__.logParseError)(\"gmail\", \"Failed to fetch PDF attachment\", {\n                        messageId,\n                        text\n                    });\n                    continue;\n                }\n                const attachJson = await attachRes.json();\n                if (!attachJson.data) continue;\n                const buffer = decodeBase64UrlToBuffer(attachJson.data);\n                const parsed = await pdfParse(buffer);\n                if (parsed?.text && parsed.text.trim().length > 0) {\n                    texts.push(parsed.text);\n                }\n                try {\n                    const bucket = \"invoices\";\n                    const fileName = typeof part.filename === \"string\" && part.filename.trim().length > 0 ? part.filename : `invoice-${messageId}-${Date.now()}.pdf`;\n                    const path = `${userId}/${messageId}/${fileName}`;\n                    const { error: uploadError } = await _lib_supabaseServer__WEBPACK_IMPORTED_MODULE_1__.supabaseServer.storage.from(bucket).upload(path, buffer, {\n                        upsert: true,\n                        contentType: \"application/pdf\"\n                    });\n                    if (uploadError) {\n                        (0,_lib_logging__WEBPACK_IMPORTED_MODULE_5__.logParseError)(\"gmail\", \"Failed to upload PDF to storage\", {\n                            messageId,\n                            error: uploadError.message\n                        });\n                    } else {\n                        const { data: publicData } = _lib_supabaseServer__WEBPACK_IMPORTED_MODULE_1__.supabaseServer.storage.from(bucket).getPublicUrl(path);\n                        if (publicData?.publicUrl) {\n                            urls.push(publicData.publicUrl);\n                        }\n                    }\n                } catch (storageErr) {\n                    (0,_lib_logging__WEBPACK_IMPORTED_MODULE_5__.logParseError)(\"gmail\", \"Exception while uploading PDF to storage\", {\n                        messageId,\n                        error: String(storageErr?.message ?? storageErr)\n                    });\n                }\n            } catch (err) {\n                (0,_lib_logging__WEBPACK_IMPORTED_MODULE_5__.logParseError)(\"gmail\", \"Failed to parse PDF attachment\", {\n                    messageId,\n                    error: String(err?.message ?? err)\n                });\n            }\n        } else if (part.parts && Array.isArray(part.parts)) {\n            partsQueue.push(...part.parts);\n        }\n    }\n    (0,_lib_logging__WEBPACK_IMPORTED_MODULE_5__.logParseError)(\"gmail\", \"PDF extraction summary\", {\n        messageId,\n        textsCount: texts.length,\n        urlsCount: urls.length\n    });\n    return {\n        texts,\n        urls\n    };\n}\nfunction extractDateFromHeaders(headers) {\n    const h = headers.find((x)=>x.name?.toLowerCase() === \"date\");\n    if (!h?.value) return null;\n    const d = new Date(h.value);\n    return Number.isNaN(d.getTime()) ? null : d.toISOString();\n}\nfunction extractHeaderValue(headers, name) {\n    const h = headers.find((x)=>x.name?.toLowerCase() === name.toLowerCase());\n    return h?.value ?? null;\n}\nfunction extractVendorFromHeaders(headers) {\n    const from = extractHeaderValue(headers, \"from\");\n    const subject = extractHeaderValue(headers, \"subject\");\n    if (from) {\n        const quoted = from.match(/\"([^\"]+)\"/);\n        if (quoted && quoted[1].trim().length > 0) {\n            return quoted[1].trim();\n        }\n        const angled = from.match(/([^<]+)</);\n        if (angled && angled[1].trim().length > 0) {\n            return angled[1].trim();\n        }\n        const beforeAngle = from.split(\"<\")[0].trim();\n        if (beforeAngle.length > 0) {\n            return beforeAngle;\n        }\n    }\n    if (subject) {\n        const cleaned = subject.replace(/\\s+/g, \" \").trim();\n        if (cleaned.length > 0 && cleaned.length <= 80) {\n            return cleaned;\n        }\n    }\n    return null;\n}\nasync function POST(request) {\n    const user = await (0,_lib_auth__WEBPACK_IMPORTED_MODULE_2__.getUserFromRequest)(request);\n    if (!user) {\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            error: \"Unauthorized\"\n        }, {\n            status: 401\n        });\n    }\n    const { data: tokenRecord, error: tokenError } = await _lib_supabaseServer__WEBPACK_IMPORTED_MODULE_1__.supabaseServer.from(\"gmail_tokens\").select(\"*\").eq(\"user_id\", user.id).maybeSingle();\n    if (tokenError || !tokenRecord) {\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            error: \"No Gmail integration configured\"\n        }, {\n            status: 400\n        });\n    }\n    const ensured = await ensureAccessToken(tokenRecord);\n    if (\"error\" in ensured) {\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            error: ensured.error\n        }, {\n            status: 500\n        });\n    }\n    const accessToken = ensured.accessToken;\n    const searchQuery = '(receipt OR \"payment received\" OR \"order confirmation\" OR invoice OR transaction) has:attachment filename:pdf';\n    // Look back approximately 12 months and explicitly require\n    // messages that have PDF attachments, to increase the chance\n    // of finding invoice PDFs.\n    const params = new URLSearchParams({\n        q: `${searchQuery} newer_than:365d`,\n        maxResults: \"50\"\n    });\n    const listRes = await fetch(`https://gmail.googleapis.com/gmail/v1/users/me/messages?${params.toString()}`, {\n        headers: {\n            Authorization: `Bearer ${accessToken}`\n        }\n    });\n    if (!listRes.ok) {\n        const text = await listRes.text();\n        (0,_lib_logging__WEBPACK_IMPORTED_MODULE_5__.logParseError)(\"gmail\", \"Failed to list messages\", {\n            text\n        });\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            error: \"Failed to list Gmail messages\"\n        }, {\n            status: 500\n        });\n    }\n    const listJson = await listRes.json();\n    const messages = listJson.messages ?? [];\n    if (messages.length === 0) {\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            inserted: 0\n        });\n    }\n    const baseAppUrl = \"http://localhost:3000\" || 0;\n    const rowsToInsert = [];\n    let pdfsStored = 0;\n    for (const { id } of messages){\n        const msgRes = await fetch(`https://gmail.googleapis.com/gmail/v1/users/me/messages/${id}?format=full`, {\n            headers: {\n                Authorization: `Bearer ${accessToken}`\n            }\n        });\n        if (!msgRes.ok) {\n            const text = await msgRes.text();\n            (0,_lib_logging__WEBPACK_IMPORTED_MODULE_5__.logParseError)(\"gmail\", \"Failed to fetch message\", {\n                id,\n                text\n            });\n            continue;\n        }\n        const msgJson = await msgRes.json();\n        const headers = msgJson.payload?.headers ?? [];\n        const dateHeader = extractDateFromHeaders(headers);\n        const bodyText = extractEmailText(msgJson);\n        const { texts: pdfTexts, urls: pdfUrls } = await extractPdfData(user.id, id, msgJson.payload, accessToken);\n        const combinedText = pdfTexts.length ? `${bodyText}\\n\\n${pdfTexts.join(\"\\n\\n\")}` : bodyText;\n        const { parsed, confidence } = (0,_lib_parsing_transactionParser__WEBPACK_IMPORTED_MODULE_4__.regexParseTransaction)(combinedText);\n        let finalParsed = parsed;\n        let finalConfidence = confidence;\n        if (!parsed.amount) {\n            try {\n                const llmRes = await fetch(`${baseAppUrl}/api/llm/parse`, {\n                    method: \"POST\",\n                    headers: {\n                        \"content-type\": \"application/json\"\n                    },\n                    body: JSON.stringify({\n                        text: combinedText\n                    })\n                });\n                if (llmRes.ok) {\n                    const llmJson = await llmRes.json();\n                    if (llmJson.parsed?.amount) {\n                        finalParsed = llmJson.parsed;\n                        finalConfidence = llmJson.confidence ?? 0.7;\n                    }\n                }\n            } catch (err) {\n                (0,_lib_logging__WEBPACK_IMPORTED_MODULE_5__.logParseError)(\"gmail\", \"LLM fallback failed\", {\n                    error: String(err?.message ?? err)\n                });\n            }\n        }\n        if (!finalParsed.amount) {\n            (0,_lib_logging__WEBPACK_IMPORTED_MODULE_5__.logParseError)(\"gmail\", \"Skipping email without parsed amount\", {\n                id\n            });\n            continue;\n        }\n        pdfsStored += pdfUrls.length;\n        const headerVendor = extractVendorFromHeaders(headers);\n        const vendorValue = headerVendor ?? finalParsed.vendor ?? null;\n        const inferredCategory = await (0,_lib_rulesEngine__WEBPACK_IMPORTED_MODULE_6__.inferCategoryFromRules)(user.id, vendorValue, combinedText);\n        rowsToInsert.push({\n            user_id: user.id,\n            source: \"gmail\",\n            amount: finalParsed.amount,\n            currency: finalParsed.currency ?? \"USD\",\n            vendor: vendorValue,\n            date: finalParsed.date ?? dateHeader ?? new Date().toISOString(),\n            invoice_pdf_url: pdfUrls[0] ?? null,\n            category: inferredCategory,\n            confidence_score: finalConfidence,\n            raw_text: combinedText,\n            reference_id: finalParsed.referenceId ?? id\n        });\n    }\n    if (rowsToInsert.length === 0) {\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            inserted: 0,\n            pdfsStored,\n            totalForUser: 0\n        });\n    }\n    const { error: insertError } = await _lib_supabaseServer__WEBPACK_IMPORTED_MODULE_1__.supabaseServer.from(\"transactions\").insert(rowsToInsert);\n    if (insertError) {\n        (0,_lib_logging__WEBPACK_IMPORTED_MODULE_5__.logParseError)(\"gmail\", \"Failed to insert Gmail transactions\", {\n            error: insertError.message\n        });\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            error: \"Failed to insert Gmail transactions\"\n        }, {\n            status: 500\n        });\n    }\n    const { count } = await _lib_supabaseServer__WEBPACK_IMPORTED_MODULE_1__.supabaseServer.from(\"transactions\").select(\"id\", {\n        count: \"exact\",\n        head: true\n    }).eq(\"user_id\", user.id);\n    return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n        inserted: rowsToInsert.length,\n        pdfsStored,\n        totalForUser: typeof count === \"number\" ? count : null\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFVTjtZQUNWTyxrQkFBa0JoQjtZQUNsQmlCLFVBQVVwQjtZQUNWcUIsY0FBY25CLFlBQVlvQixXQUFXLElBQUkvSDtRQUMzQztJQUNGO0lBRUEsSUFBSWlHLGFBQWFwRixNQUFNLEtBQUssR0FBRztRQUM3QixPQUFPM0Qsa0ZBQVlBLENBQUNzQyxJQUFJLENBQUM7WUFBRXNHLFVBQVU7WUFBR0k7WUFBWThCLGNBQWM7UUFBRTtJQUN0RTtJQUVBLE1BQU0sRUFBRTdKLE9BQU84SixXQUFXLEVBQUUsR0FBRyxNQUFNOUssK0RBQWNBLENBQ2hEMEMsSUFBSSxDQUFDLGdCQUNMcUksTUFBTSxDQUFDakM7SUFFVixJQUFJZ0MsYUFBYTtRQUNmekssMkRBQWFBLENBQUMsU0FBUyx1Q0FBdUM7WUFDNURXLE9BQU84SixZQUFZaEksT0FBTztRQUM1QjtRQUNBLE9BQU8vQyxrRkFBWUEsQ0FBQ3NDLElBQUksQ0FDdEI7WUFBRXJCLE9BQU87UUFBc0MsR0FDL0M7WUFBRThHLFFBQVE7UUFBSTtJQUVsQjtJQUVBLE1BQU0sRUFBRWtELEtBQUssRUFBRSxHQUFHLE1BQU1oTCwrREFBY0EsQ0FDbkMwQyxJQUFJLENBQUMsZ0JBQ0x1RixNQUFNLENBQUMsTUFBTTtRQUFFK0MsT0FBTztRQUFTQyxNQUFNO0lBQUssR0FDMUNySSxFQUFFLENBQUMsV0FBV2lGLEtBQUtoRixFQUFFO0lBRXhCLE9BQU85QyxrRkFBWUEsQ0FBQ3NDLElBQUksQ0FBQztRQUN2QnNHLFVBQVVHLGFBQWFwRixNQUFNO1FBQzdCcUY7UUFDQThCLGNBQWMsT0FBT0csVUFBVSxXQUFXQSxRQUFRO0lBQ3BEO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9leHBlbnNlLXRyYWNrZXIvLi9zcmMvYXBwL2FwaS9nbWFpbC9zeW5jL3JvdXRlLnRzP2I4ZDIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gXCJuZXh0L3NlcnZlclwiO1xyXG5pbXBvcnQgeyBzdXBhYmFzZVNlcnZlciB9IGZyb20gXCJAL2xpYi9zdXBhYmFzZVNlcnZlclwiO1xyXG5pbXBvcnQgeyBnZXRVc2VyRnJvbVJlcXVlc3QgfSBmcm9tIFwiQC9saWIvYXV0aFwiO1xyXG5pbXBvcnQgeyBkZWNyeXB0VG9rZW4sIGVuY3J5cHRUb2tlbiB9IGZyb20gXCJAL2xpYi9nbWFpbENyeXB0b1wiO1xyXG5pbXBvcnQgeyByZWdleFBhcnNlVHJhbnNhY3Rpb24gfSBmcm9tIFwiQC9saWIvcGFyc2luZy90cmFuc2FjdGlvblBhcnNlclwiO1xyXG5pbXBvcnQgeyBsb2dQYXJzZUVycm9yIH0gZnJvbSBcIkAvbGliL2xvZ2dpbmdcIjtcclxuaW1wb3J0IHsgaW5mZXJDYXRlZ29yeUZyb21SdWxlcyB9IGZyb20gXCJAL2xpYi9ydWxlc0VuZ2luZVwiO1xyXG5cclxuZXhwb3J0IGNvbnN0IHJ1bnRpbWUgPSBcIm5vZGVqc1wiO1xyXG5cclxudHlwZSBHbWFpbFRva2VuUmVjb3JkID0ge1xyXG4gIGlkOiBzdHJpbmc7XHJcbiAgdXNlcl9pZDogc3RyaW5nO1xyXG4gIGFjY2Vzc190b2tlbjogc3RyaW5nO1xyXG4gIHJlZnJlc2hfdG9rZW46IHN0cmluZyB8IG51bGw7XHJcbiAgZXhwaXJ5X2RhdGU6IHN0cmluZyB8IG51bGw7XHJcbn07XHJcblxyXG50eXBlIFBkZkV4dHJhY3Rpb25SZXN1bHQgPSB7XHJcbiAgdGV4dHM6IHN0cmluZ1tdO1xyXG4gIHVybHM6IHN0cmluZ1tdO1xyXG59O1xyXG5cclxuYXN5bmMgZnVuY3Rpb24gZW5zdXJlQWNjZXNzVG9rZW4oXHJcbiAgcmVjb3JkOiBHbWFpbFRva2VuUmVjb3JkXHJcbik6IFByb21pc2U8eyBhY2Nlc3NUb2tlbjogc3RyaW5nIH0gfCB7IGVycm9yOiBzdHJpbmcgfT4ge1xyXG4gIGNvbnN0IGNsaWVudElkID0gcHJvY2Vzcy5lbnYuR09PR0xFX09BVVRIX0NMSUVOVF9JRDtcclxuICBjb25zdCBjbGllbnRTZWNyZXQgPSBwcm9jZXNzLmVudi5HT09HTEVfT0FVVEhfQ0xJRU5UX1NFQ1JFVDtcclxuXHJcbiAgaWYgKCFjbGllbnRJZCB8fCAhY2xpZW50U2VjcmV0KSB7XHJcbiAgICByZXR1cm4geyBlcnJvcjogXCJHbWFpbCBPQXV0aCBlbnYgdmFycyBhcmUgbm90IHNldFwiIH07XHJcbiAgfVxyXG5cclxuICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xyXG4gIGNvbnN0IGV4cGlyeU1zID0gcmVjb3JkLmV4cGlyeV9kYXRlID8gbmV3IERhdGUocmVjb3JkLmV4cGlyeV9kYXRlKS5nZXRUaW1lKCkgOiAwO1xyXG5cclxuICAvLyBJZiB0b2tlbiBub3QgbmVhciBleHBpcnkgKDYwcyBidWZmZXIpLCBqdXN0IHVzZSBpdFxyXG4gIGlmIChleHBpcnlNcyAtIG5vdyA+IDYwICogMTAwMCkge1xyXG4gICAgcmV0dXJuIHsgYWNjZXNzVG9rZW46IGRlY3J5cHRUb2tlbihyZWNvcmQuYWNjZXNzX3Rva2VuKSB9O1xyXG4gIH1cclxuXHJcbiAgaWYgKCFyZWNvcmQucmVmcmVzaF90b2tlbikge1xyXG4gICAgcmV0dXJuIHsgYWNjZXNzVG9rZW46IGRlY3J5cHRUb2tlbihyZWNvcmQuYWNjZXNzX3Rva2VuKSB9O1xyXG4gIH1cclxuXHJcbiAgY29uc3QgcmVmcmVzaFJlcyA9IGF3YWl0IGZldGNoKFwiaHR0cHM6Ly9vYXV0aDIuZ29vZ2xlYXBpcy5jb20vdG9rZW5cIiwge1xyXG4gICAgbWV0aG9kOiBcIlBPU1RcIixcclxuICAgIGhlYWRlcnM6IHsgXCJjb250ZW50LXR5cGVcIjogXCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWRcIiB9LFxyXG4gICAgYm9keTogbmV3IFVSTFNlYXJjaFBhcmFtcyh7XHJcbiAgICAgIGNsaWVudF9pZDogY2xpZW50SWQsXHJcbiAgICAgIGNsaWVudF9zZWNyZXQ6IGNsaWVudFNlY3JldCxcclxuICAgICAgZ3JhbnRfdHlwZTogXCJyZWZyZXNoX3Rva2VuXCIsXHJcbiAgICAgIHJlZnJlc2hfdG9rZW46IGRlY3J5cHRUb2tlbihyZWNvcmQucmVmcmVzaF90b2tlbilcclxuICAgIH0pLnRvU3RyaW5nKClcclxuICB9KTtcclxuXHJcbiAgaWYgKCFyZWZyZXNoUmVzLm9rKSB7XHJcbiAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVmcmVzaFJlcy50ZXh0KCk7XHJcbiAgICBsb2dQYXJzZUVycm9yKFwiZ21haWxcIiwgXCJGYWlsZWQgdG8gcmVmcmVzaCBhY2Nlc3MgdG9rZW5cIiwgeyB0ZXh0IH0pO1xyXG4gICAgcmV0dXJuIHsgZXJyb3I6IFwiRmFpbGVkIHRvIHJlZnJlc2ggYWNjZXNzIHRva2VuXCIgfTtcclxuICB9XHJcblxyXG4gIGNvbnN0IGpzb24gPSAoYXdhaXQgcmVmcmVzaFJlcy5qc29uKCkpIGFzIHtcclxuICAgIGFjY2Vzc190b2tlbjogc3RyaW5nO1xyXG4gICAgZXhwaXJlc19pbj86IG51bWJlcjtcclxuICB9O1xyXG5cclxuICBjb25zdCBuZXdBY2Nlc3NUb2tlbiA9IGpzb24uYWNjZXNzX3Rva2VuO1xyXG4gIGNvbnN0IGV4cGlyeURhdGUgPSBuZXcgRGF0ZShEYXRlLm5vdygpICsgKGpzb24uZXhwaXJlc19pbiA/PyAzNjAwKSAqIDEwMDApLnRvSVNPU3RyaW5nKCk7XHJcblxyXG4gIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlU2VydmVyXHJcbiAgICAuZnJvbShcImdtYWlsX3Rva2Vuc1wiKVxyXG4gICAgLnVwZGF0ZSh7XHJcbiAgICAgIGFjY2Vzc190b2tlbjogZW5jcnlwdFRva2VuKG5ld0FjY2Vzc1Rva2VuKSxcclxuICAgICAgZXhwaXJ5X2RhdGU6IGV4cGlyeURhdGVcclxuICAgIH0pXHJcbiAgICAuZXEoXCJpZFwiLCByZWNvcmQuaWQpO1xyXG5cclxuICBpZiAoZXJyb3IpIHtcclxuICAgIGxvZ1BhcnNlRXJyb3IoXCJnbWFpbFwiLCBcIkZhaWxlZCB0byB1cGRhdGUgcmVmcmVzaGVkIHRva2VuIGluIERCXCIsIHtcclxuICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2VcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHsgYWNjZXNzVG9rZW46IG5ld0FjY2Vzc1Rva2VuIH07XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGRlY29kZUJhc2U2NFVybChkYXRhOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gIGNvbnN0IG5vcm1hbGl6ZWQgPSBkYXRhLnJlcGxhY2UoLy0vZywgXCIrXCIpLnJlcGxhY2UoL18vZywgXCIvXCIpO1xyXG4gIGNvbnN0IGJ1ZmYgPSBCdWZmZXIuZnJvbShub3JtYWxpemVkLCBcImJhc2U2NFwiKTtcclxuICByZXR1cm4gYnVmZi50b1N0cmluZyhcInV0ZjhcIik7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGRlY29kZUJhc2U2NFVybFRvQnVmZmVyKGRhdGE6IHN0cmluZyk6IEJ1ZmZlciB7XHJcbiAgY29uc3Qgbm9ybWFsaXplZCA9IGRhdGEucmVwbGFjZSgvLS9nLCBcIitcIikucmVwbGFjZSgvXy9nLCBcIi9cIik7XHJcbiAgcmV0dXJuIEJ1ZmZlci5mcm9tKG5vcm1hbGl6ZWQsIFwiYmFzZTY0XCIpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBleHRyYWN0RW1haWxUZXh0KG1lc3NhZ2U6IGFueSk6IHN0cmluZyB7XHJcbiAgY29uc3QgcGF5bG9hZCA9IG1lc3NhZ2UucGF5bG9hZDtcclxuXHJcbiAgY29uc3QgcGFydHNRdWV1ZTogYW55W10gPSBbcGF5bG9hZF07XHJcbiAgY29uc3QgdGV4dHM6IHN0cmluZ1tdID0gW107XHJcblxyXG4gIHdoaWxlIChwYXJ0c1F1ZXVlLmxlbmd0aCA+IDApIHtcclxuICAgIGNvbnN0IHBhcnQgPSBwYXJ0c1F1ZXVlLnBvcCgpO1xyXG4gICAgaWYgKCFwYXJ0KSBjb250aW51ZTtcclxuXHJcbiAgICBpZiAocGFydC5taW1lVHlwZSA9PT0gXCJ0ZXh0L3BsYWluXCIgJiYgcGFydC5ib2R5Py5kYXRhKSB7XHJcbiAgICAgIHRleHRzLnB1c2goZGVjb2RlQmFzZTY0VXJsKHBhcnQuYm9keS5kYXRhKSk7XHJcbiAgICB9IGVsc2UgaWYgKHBhcnQubWltZVR5cGUgPT09IFwidGV4dC9odG1sXCIgJiYgcGFydC5ib2R5Py5kYXRhKSB7XHJcbiAgICAgIGNvbnN0IGh0bWwgPSBkZWNvZGVCYXNlNjRVcmwocGFydC5ib2R5LmRhdGEpO1xyXG4gICAgICBjb25zdCB0ZXh0ID0gaHRtbC5yZXBsYWNlKC88W14+XSs+L2csIFwiIFwiKTtcclxuICAgICAgdGV4dHMucHVzaCh0ZXh0KTtcclxuICAgIH0gZWxzZSBpZiAocGFydC5wYXJ0cyAmJiBBcnJheS5pc0FycmF5KHBhcnQucGFydHMpKSB7XHJcbiAgICAgIHBhcnRzUXVldWUucHVzaCguLi5wYXJ0LnBhcnRzKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGlmICh0ZXh0cy5sZW5ndGggPT09IDAgJiYgcGF5bG9hZC5ib2R5Py5kYXRhKSB7XHJcbiAgICB0ZXh0cy5wdXNoKGRlY29kZUJhc2U2NFVybChwYXlsb2FkLmJvZHkuZGF0YSkpO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHRleHRzLmpvaW4oXCJcXG5cXG5cIik7XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGV4dHJhY3RQZGZEYXRhKFxyXG4gIHVzZXJJZDogc3RyaW5nLFxyXG4gIG1lc3NhZ2VJZDogc3RyaW5nLFxyXG4gIHBheWxvYWQ6IGFueSxcclxuICBhY2Nlc3NUb2tlbjogc3RyaW5nXHJcbik6IFByb21pc2U8UGRmRXh0cmFjdGlvblJlc3VsdD4ge1xyXG4gIGNvbnN0IHRleHRzOiBzdHJpbmdbXSA9IFtdO1xyXG4gIGNvbnN0IHVybHM6IHN0cmluZ1tdID0gW107XHJcbiAgY29uc3QgcGFydHNRdWV1ZTogYW55W10gPSBbcGF5bG9hZF07XHJcblxyXG4gIHdoaWxlIChwYXJ0c1F1ZXVlLmxlbmd0aCA+IDApIHtcclxuICAgIGNvbnN0IHBhcnQgPSBwYXJ0c1F1ZXVlLnBvcCgpO1xyXG4gICAgaWYgKCFwYXJ0KSBjb250aW51ZTtcclxuXHJcbiAgICBjb25zdCBpc1BkZk1pbWUgPSBwYXJ0Lm1pbWVUeXBlID09PSBcImFwcGxpY2F0aW9uL3BkZlwiO1xyXG4gICAgY29uc3QgcmF3RmlsZW5hbWUgPVxyXG4gICAgICB0eXBlb2YgcGFydC5maWxlbmFtZSA9PT0gXCJzdHJpbmdcIiA/IHBhcnQuZmlsZW5hbWUudHJpbSgpIDogXCJcIjtcclxuICAgIGNvbnN0IGlzUGRmRmlsZW5hbWUgPSByYXdGaWxlbmFtZS50b0xvd2VyQ2FzZSgpLmVuZHNXaXRoKFwiLnBkZlwiKTtcclxuXHJcbiAgICBsb2dQYXJzZUVycm9yKFwiZ21haWxcIiwgXCJJbnNwZWN0aW5nIE1JTUUgcGFydFwiLCB7XHJcbiAgICAgIG1lc3NhZ2VJZCxcclxuICAgICAgbWltZVR5cGU6IHBhcnQubWltZVR5cGUsXHJcbiAgICAgIGZpbGVuYW1lOiBwYXJ0LmZpbGVuYW1lID8/IG51bGwsXHJcbiAgICAgIGhhc0F0dGFjaG1lbnRJZDogISFwYXJ0LmJvZHk/LmF0dGFjaG1lbnRJZCxcclxuICAgICAgaXNQZGZNaW1lLFxyXG4gICAgICBpc1BkZkZpbGVuYW1lXHJcbiAgICB9KTtcclxuXHJcbiAgICBpZiAoKGlzUGRmTWltZSB8fCBpc1BkZkZpbGVuYW1lKSAmJiBwYXJ0LmJvZHk/LmF0dGFjaG1lbnRJZCkge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHBkZk1vZHVsZSA9IGF3YWl0IGltcG9ydChcInBkZi1wYXJzZVwiKTtcclxuICAgICAgICBjb25zdCBwZGZQYXJzZSA9IChwZGZNb2R1bGUgYXMgYW55KS5kZWZhdWx0IHx8IChwZGZNb2R1bGUgYXMgYW55KTtcclxuXHJcbiAgICAgICAgY29uc3QgYXR0YWNoUmVzID0gYXdhaXQgZmV0Y2goXHJcbiAgICAgICAgICBgaHR0cHM6Ly9nbWFpbC5nb29nbGVhcGlzLmNvbS9nbWFpbC92MS91c2Vycy9tZS9tZXNzYWdlcy8ke21lc3NhZ2VJZH0vYXR0YWNobWVudHMvJHtwYXJ0LmJvZHkuYXR0YWNobWVudElkfWAsXHJcbiAgICAgICAgICB7XHJcbiAgICAgICAgICAgIGhlYWRlcnM6IHsgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke2FjY2Vzc1Rva2VufWAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIGlmICghYXR0YWNoUmVzLm9rKSB7XHJcbiAgICAgICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgYXR0YWNoUmVzLnRleHQoKTtcclxuICAgICAgICAgIGxvZ1BhcnNlRXJyb3IoXCJnbWFpbFwiLCBcIkZhaWxlZCB0byBmZXRjaCBQREYgYXR0YWNobWVudFwiLCB7XHJcbiAgICAgICAgICAgIG1lc3NhZ2VJZCxcclxuICAgICAgICAgICAgdGV4dFxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGF0dGFjaEpzb24gPSAoYXdhaXQgYXR0YWNoUmVzLmpzb24oKSkgYXMgeyBkYXRhPzogc3RyaW5nIH07XHJcbiAgICAgICAgaWYgKCFhdHRhY2hKc29uLmRhdGEpIGNvbnRpbnVlO1xyXG5cclxuICAgICAgICBjb25zdCBidWZmZXIgPSBkZWNvZGVCYXNlNjRVcmxUb0J1ZmZlcihhdHRhY2hKc29uLmRhdGEpO1xyXG4gICAgICAgIGNvbnN0IHBhcnNlZDogYW55ID0gYXdhaXQgcGRmUGFyc2UoYnVmZmVyKTtcclxuICAgICAgICBpZiAocGFyc2VkPy50ZXh0ICYmIHBhcnNlZC50ZXh0LnRyaW0oKS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICB0ZXh0cy5wdXNoKHBhcnNlZC50ZXh0KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICBjb25zdCBidWNrZXQgPSBcImludm9pY2VzXCI7XHJcbiAgICAgICAgICBjb25zdCBmaWxlTmFtZSA9XHJcbiAgICAgICAgICAgIHR5cGVvZiBwYXJ0LmZpbGVuYW1lID09PSBcInN0cmluZ1wiICYmIHBhcnQuZmlsZW5hbWUudHJpbSgpLmxlbmd0aCA+IDBcclxuICAgICAgICAgICAgICA/IHBhcnQuZmlsZW5hbWVcclxuICAgICAgICAgICAgICA6IGBpbnZvaWNlLSR7bWVzc2FnZUlkfS0ke0RhdGUubm93KCl9LnBkZmA7XHJcbiAgICAgICAgICBjb25zdCBwYXRoID0gYCR7dXNlcklkfS8ke21lc3NhZ2VJZH0vJHtmaWxlTmFtZX1gO1xyXG5cclxuICAgICAgICAgIGNvbnN0IHsgZXJyb3I6IHVwbG9hZEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVNlcnZlci5zdG9yYWdlXHJcbiAgICAgICAgICAgIC5mcm9tKGJ1Y2tldClcclxuICAgICAgICAgICAgLnVwbG9hZChwYXRoLCBidWZmZXIsIHtcclxuICAgICAgICAgICAgICB1cHNlcnQ6IHRydWUsXHJcbiAgICAgICAgICAgICAgY29udGVudFR5cGU6IFwiYXBwbGljYXRpb24vcGRmXCJcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgaWYgKHVwbG9hZEVycm9yKSB7XHJcbiAgICAgICAgICAgIGxvZ1BhcnNlRXJyb3IoXCJnbWFpbFwiLCBcIkZhaWxlZCB0byB1cGxvYWQgUERGIHRvIHN0b3JhZ2VcIiwge1xyXG4gICAgICAgICAgICAgIG1lc3NhZ2VJZCxcclxuICAgICAgICAgICAgICBlcnJvcjogdXBsb2FkRXJyb3IubWVzc2FnZVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHsgZGF0YTogcHVibGljRGF0YSB9ID0gc3VwYWJhc2VTZXJ2ZXIuc3RvcmFnZVxyXG4gICAgICAgICAgICAgIC5mcm9tKGJ1Y2tldClcclxuICAgICAgICAgICAgICAuZ2V0UHVibGljVXJsKHBhdGgpO1xyXG4gICAgICAgICAgICBpZiAocHVibGljRGF0YT8ucHVibGljVXJsKSB7XHJcbiAgICAgICAgICAgICAgdXJscy5wdXNoKHB1YmxpY0RhdGEucHVibGljVXJsKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0gY2F0Y2ggKHN0b3JhZ2VFcnI6IGFueSkge1xyXG4gICAgICAgICAgbG9nUGFyc2VFcnJvcihcclxuICAgICAgICAgICAgXCJnbWFpbFwiLFxyXG4gICAgICAgICAgICBcIkV4Y2VwdGlvbiB3aGlsZSB1cGxvYWRpbmcgUERGIHRvIHN0b3JhZ2VcIixcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgIG1lc3NhZ2VJZCxcclxuICAgICAgICAgICAgICBlcnJvcjogU3RyaW5nKHN0b3JhZ2VFcnI/Lm1lc3NhZ2UgPz8gc3RvcmFnZUVycilcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gY2F0Y2ggKGVycjogYW55KSB7XHJcbiAgICAgICAgbG9nUGFyc2VFcnJvcihcImdtYWlsXCIsIFwiRmFpbGVkIHRvIHBhcnNlIFBERiBhdHRhY2htZW50XCIsIHtcclxuICAgICAgICAgIG1lc3NhZ2VJZCxcclxuICAgICAgICAgIGVycm9yOiBTdHJpbmcoZXJyPy5tZXNzYWdlID8/IGVycilcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIGlmIChwYXJ0LnBhcnRzICYmIEFycmF5LmlzQXJyYXkocGFydC5wYXJ0cykpIHtcclxuICAgICAgcGFydHNRdWV1ZS5wdXNoKC4uLnBhcnQucGFydHMpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgbG9nUGFyc2VFcnJvcihcImdtYWlsXCIsIFwiUERGIGV4dHJhY3Rpb24gc3VtbWFyeVwiLCB7XHJcbiAgICBtZXNzYWdlSWQsXHJcbiAgICB0ZXh0c0NvdW50OiB0ZXh0cy5sZW5ndGgsXHJcbiAgICB1cmxzQ291bnQ6IHVybHMubGVuZ3RoXHJcbiAgfSk7XHJcblxyXG4gIHJldHVybiB7IHRleHRzLCB1cmxzIH07XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGV4dHJhY3REYXRlRnJvbUhlYWRlcnMoaGVhZGVyczogYW55W10pOiBzdHJpbmcgfCBudWxsIHtcclxuICBjb25zdCBoID0gaGVhZGVycy5maW5kKCh4KSA9PiB4Lm5hbWU/LnRvTG93ZXJDYXNlKCkgPT09IFwiZGF0ZVwiKTtcclxuICBpZiAoIWg/LnZhbHVlKSByZXR1cm4gbnVsbDtcclxuICBjb25zdCBkID0gbmV3IERhdGUoaC52YWx1ZSk7XHJcbiAgcmV0dXJuIE51bWJlci5pc05hTihkLmdldFRpbWUoKSkgPyBudWxsIDogZC50b0lTT1N0cmluZygpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBleHRyYWN0SGVhZGVyVmFsdWUoaGVhZGVyczogYW55W10sIG5hbWU6IHN0cmluZyk6IHN0cmluZyB8IG51bGwge1xyXG4gIGNvbnN0IGggPSBoZWFkZXJzLmZpbmQoKHgpID0+IHgubmFtZT8udG9Mb3dlckNhc2UoKSA9PT0gbmFtZS50b0xvd2VyQ2FzZSgpKTtcclxuICByZXR1cm4gaD8udmFsdWUgPz8gbnVsbDtcclxufVxyXG5cclxuZnVuY3Rpb24gZXh0cmFjdFZlbmRvckZyb21IZWFkZXJzKGhlYWRlcnM6IGFueVtdKTogc3RyaW5nIHwgbnVsbCB7XHJcbiAgY29uc3QgZnJvbSA9IGV4dHJhY3RIZWFkZXJWYWx1ZShoZWFkZXJzLCBcImZyb21cIik7XHJcbiAgY29uc3Qgc3ViamVjdCA9IGV4dHJhY3RIZWFkZXJWYWx1ZShoZWFkZXJzLCBcInN1YmplY3RcIik7XHJcblxyXG4gIGlmIChmcm9tKSB7XHJcbiAgICBjb25zdCBxdW90ZWQgPSBmcm9tLm1hdGNoKC9cIihbXlwiXSspXCIvKTtcclxuICAgIGlmIChxdW90ZWQgJiYgcXVvdGVkWzFdLnRyaW0oKS5sZW5ndGggPiAwKSB7XHJcbiAgICAgIHJldHVybiBxdW90ZWRbMV0udHJpbSgpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGFuZ2xlZCA9IGZyb20ubWF0Y2goLyhbXjxdKyk8Lyk7XHJcbiAgICBpZiAoYW5nbGVkICYmIGFuZ2xlZFsxXS50cmltKCkubGVuZ3RoID4gMCkge1xyXG4gICAgICByZXR1cm4gYW5nbGVkWzFdLnRyaW0oKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBiZWZvcmVBbmdsZSA9IGZyb20uc3BsaXQoXCI8XCIpWzBdLnRyaW0oKTtcclxuICAgIGlmIChiZWZvcmVBbmdsZS5sZW5ndGggPiAwKSB7XHJcbiAgICAgIHJldHVybiBiZWZvcmVBbmdsZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGlmIChzdWJqZWN0KSB7XHJcbiAgICBjb25zdCBjbGVhbmVkID0gc3ViamVjdC5yZXBsYWNlKC9cXHMrL2csIFwiIFwiKS50cmltKCk7XHJcbiAgICBpZiAoY2xlYW5lZC5sZW5ndGggPiAwICYmIGNsZWFuZWQubGVuZ3RoIDw9IDgwKSB7XHJcbiAgICAgIHJldHVybiBjbGVhbmVkO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIG51bGw7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XHJcbiAgY29uc3QgdXNlciA9IGF3YWl0IGdldFVzZXJGcm9tUmVxdWVzdChyZXF1ZXN0KTtcclxuICBpZiAoIXVzZXIpIHtcclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH0sIHsgc3RhdHVzOiA0MDEgfSk7XHJcbiAgfVxyXG5cclxuICBjb25zdCB7IGRhdGE6IHRva2VuUmVjb3JkLCBlcnJvcjogdG9rZW5FcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VTZXJ2ZXJcclxuICAgIC5mcm9tKFwiZ21haWxfdG9rZW5zXCIpXHJcbiAgICAuc2VsZWN0KFwiKlwiKVxyXG4gICAgLmVxKFwidXNlcl9pZFwiLCB1c2VyLmlkKVxyXG4gICAgLm1heWJlU2luZ2xlPEdtYWlsVG9rZW5SZWNvcmQ+KCk7XHJcblxyXG4gIGlmICh0b2tlbkVycm9yIHx8ICF0b2tlblJlY29yZCkge1xyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICB7IGVycm9yOiBcIk5vIEdtYWlsIGludGVncmF0aW9uIGNvbmZpZ3VyZWRcIiB9LFxyXG4gICAgICB7IHN0YXR1czogNDAwIH1cclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBjb25zdCBlbnN1cmVkID0gYXdhaXQgZW5zdXJlQWNjZXNzVG9rZW4odG9rZW5SZWNvcmQpO1xyXG4gIGlmIChcImVycm9yXCIgaW4gZW5zdXJlZCkge1xyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IGVuc3VyZWQuZXJyb3IgfSwgeyBzdGF0dXM6IDUwMCB9KTtcclxuICB9XHJcblxyXG4gIGNvbnN0IGFjY2Vzc1Rva2VuID0gZW5zdXJlZC5hY2Nlc3NUb2tlbjtcclxuXHJcbiAgY29uc3Qgc2VhcmNoUXVlcnkgPVxyXG4gICAgJyhyZWNlaXB0IE9SIFwicGF5bWVudCByZWNlaXZlZFwiIE9SIFwib3JkZXIgY29uZmlybWF0aW9uXCIgT1IgaW52b2ljZSBPUiB0cmFuc2FjdGlvbikgaGFzOmF0dGFjaG1lbnQgZmlsZW5hbWU6cGRmJztcclxuXHJcbiAgLy8gTG9vayBiYWNrIGFwcHJveGltYXRlbHkgMTIgbW9udGhzIGFuZCBleHBsaWNpdGx5IHJlcXVpcmVcclxuICAvLyBtZXNzYWdlcyB0aGF0IGhhdmUgUERGIGF0dGFjaG1lbnRzLCB0byBpbmNyZWFzZSB0aGUgY2hhbmNlXHJcbiAgLy8gb2YgZmluZGluZyBpbnZvaWNlIFBERnMuXHJcbiAgY29uc3QgcGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh7XHJcbiAgICBxOiBgJHtzZWFyY2hRdWVyeX0gbmV3ZXJfdGhhbjozNjVkYCxcclxuICAgIG1heFJlc3VsdHM6IFwiNTBcIlxyXG4gIH0pO1xyXG5cclxuICBjb25zdCBsaXN0UmVzID0gYXdhaXQgZmV0Y2goXHJcbiAgICBgaHR0cHM6Ly9nbWFpbC5nb29nbGVhcGlzLmNvbS9nbWFpbC92MS91c2Vycy9tZS9tZXNzYWdlcz8ke3BhcmFtcy50b1N0cmluZygpfWAsXHJcbiAgICB7XHJcbiAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7YWNjZXNzVG9rZW59YFxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgKTtcclxuXHJcbiAgaWYgKCFsaXN0UmVzLm9rKSB7XHJcbiAgICBjb25zdCB0ZXh0ID0gYXdhaXQgbGlzdFJlcy50ZXh0KCk7XHJcbiAgICBsb2dQYXJzZUVycm9yKFwiZ21haWxcIiwgXCJGYWlsZWQgdG8gbGlzdCBtZXNzYWdlc1wiLCB7IHRleHQgfSk7XHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgIHsgZXJyb3I6IFwiRmFpbGVkIHRvIGxpc3QgR21haWwgbWVzc2FnZXNcIiB9LFxyXG4gICAgICB7IHN0YXR1czogNTAwIH1cclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBjb25zdCBsaXN0SnNvbiA9IChhd2FpdCBsaXN0UmVzLmpzb24oKSkgYXMge1xyXG4gICAgbWVzc2FnZXM/OiB7IGlkOiBzdHJpbmcgfVtdO1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IG1lc3NhZ2VzID0gbGlzdEpzb24ubWVzc2FnZXMgPz8gW107XHJcbiAgaWYgKG1lc3NhZ2VzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgaW5zZXJ0ZWQ6IDAgfSk7XHJcbiAgfVxyXG5cclxuICBjb25zdCBiYXNlQXBwVXJsID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfQVBQX1VSTCB8fCBcImh0dHA6Ly9sb2NhbGhvc3Q6MzAwMFwiO1xyXG4gIGNvbnN0IHJvd3NUb0luc2VydDogYW55W10gPSBbXTtcclxuICBsZXQgcGRmc1N0b3JlZCA9IDA7XHJcblxyXG4gIGZvciAoY29uc3QgeyBpZCB9IG9mIG1lc3NhZ2VzKSB7XHJcbiAgICBjb25zdCBtc2dSZXMgPSBhd2FpdCBmZXRjaChcclxuICAgICAgYGh0dHBzOi8vZ21haWwuZ29vZ2xlYXBpcy5jb20vZ21haWwvdjEvdXNlcnMvbWUvbWVzc2FnZXMvJHtpZH0/Zm9ybWF0PWZ1bGxgLFxyXG4gICAgICB7XHJcbiAgICAgICAgaGVhZGVyczogeyBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7YWNjZXNzVG9rZW59YCB9XHJcbiAgICAgIH1cclxuICAgICk7XHJcblxyXG4gICAgaWYgKCFtc2dSZXMub2spIHtcclxuICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IG1zZ1Jlcy50ZXh0KCk7XHJcbiAgICAgIGxvZ1BhcnNlRXJyb3IoXCJnbWFpbFwiLCBcIkZhaWxlZCB0byBmZXRjaCBtZXNzYWdlXCIsIHsgaWQsIHRleHQgfSk7XHJcbiAgICAgIGNvbnRpbnVlO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IG1zZ0pzb24gPSAoYXdhaXQgbXNnUmVzLmpzb24oKSkgYXMgYW55O1xyXG4gICAgY29uc3QgaGVhZGVycyA9IG1zZ0pzb24ucGF5bG9hZD8uaGVhZGVycyA/PyBbXTtcclxuICAgIGNvbnN0IGRhdGVIZWFkZXIgPSBleHRyYWN0RGF0ZUZyb21IZWFkZXJzKGhlYWRlcnMpO1xyXG4gICAgY29uc3QgYm9keVRleHQgPSBleHRyYWN0RW1haWxUZXh0KG1zZ0pzb24pO1xyXG4gICAgY29uc3QgeyB0ZXh0czogcGRmVGV4dHMsIHVybHM6IHBkZlVybHMgfSA9IGF3YWl0IGV4dHJhY3RQZGZEYXRhKFxyXG4gICAgICB1c2VyLmlkLFxyXG4gICAgICBpZCxcclxuICAgICAgbXNnSnNvbi5wYXlsb2FkLFxyXG4gICAgICBhY2Nlc3NUb2tlblxyXG4gICAgKTtcclxuICAgIGNvbnN0IGNvbWJpbmVkVGV4dCA9IHBkZlRleHRzLmxlbmd0aFxyXG4gICAgICA/IGAke2JvZHlUZXh0fVxcblxcbiR7cGRmVGV4dHMuam9pbihcIlxcblxcblwiKX1gXHJcbiAgICAgIDogYm9keVRleHQ7XHJcblxyXG4gICAgY29uc3QgeyBwYXJzZWQsIGNvbmZpZGVuY2UgfSA9IHJlZ2V4UGFyc2VUcmFuc2FjdGlvbihjb21iaW5lZFRleHQpO1xyXG5cclxuICAgIGxldCBmaW5hbFBhcnNlZCA9IHBhcnNlZDtcclxuICAgIGxldCBmaW5hbENvbmZpZGVuY2UgPSBjb25maWRlbmNlO1xyXG5cclxuICAgIGlmICghcGFyc2VkLmFtb3VudCkge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IGxsbVJlcyA9IGF3YWl0IGZldGNoKGAke2Jhc2VBcHBVcmx9L2FwaS9sbG0vcGFyc2VgLCB7XHJcbiAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxyXG4gICAgICAgICAgaGVhZGVyczogeyBcImNvbnRlbnQtdHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIiB9LFxyXG4gICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyB0ZXh0OiBjb21iaW5lZFRleHQgfSlcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaWYgKGxsbVJlcy5vaykge1xyXG4gICAgICAgICAgY29uc3QgbGxtSnNvbiA9IChhd2FpdCBsbG1SZXMuanNvbigpKSBhcyB7XHJcbiAgICAgICAgICAgIHBhcnNlZD86IHR5cGVvZiBwYXJzZWQ7XHJcbiAgICAgICAgICAgIGNvbmZpZGVuY2U/OiBudW1iZXI7XHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgICAgaWYgKGxsbUpzb24ucGFyc2VkPy5hbW91bnQpIHtcclxuICAgICAgICAgICAgZmluYWxQYXJzZWQgPSBsbG1Kc29uLnBhcnNlZDtcclxuICAgICAgICAgICAgZmluYWxDb25maWRlbmNlID0gbGxtSnNvbi5jb25maWRlbmNlID8/IDAuNztcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH0gY2F0Y2ggKGVycjogYW55KSB7XHJcbiAgICAgICAgbG9nUGFyc2VFcnJvcihcImdtYWlsXCIsIFwiTExNIGZhbGxiYWNrIGZhaWxlZFwiLCB7XHJcbiAgICAgICAgICBlcnJvcjogU3RyaW5nKGVycj8ubWVzc2FnZSA/PyBlcnIpXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBpZiAoIWZpbmFsUGFyc2VkLmFtb3VudCkge1xyXG4gICAgICBsb2dQYXJzZUVycm9yKFwiZ21haWxcIiwgXCJTa2lwcGluZyBlbWFpbCB3aXRob3V0IHBhcnNlZCBhbW91bnRcIiwge1xyXG4gICAgICAgIGlkXHJcbiAgICAgIH0pO1xyXG4gICAgICBjb250aW51ZTtcclxuICAgIH1cclxuXHJcbiAgICBwZGZzU3RvcmVkICs9IHBkZlVybHMubGVuZ3RoO1xyXG5cclxuICAgIGNvbnN0IGhlYWRlclZlbmRvciA9IGV4dHJhY3RWZW5kb3JGcm9tSGVhZGVycyhoZWFkZXJzKTtcclxuICAgIGNvbnN0IHZlbmRvclZhbHVlID0gaGVhZGVyVmVuZG9yID8/IGZpbmFsUGFyc2VkLnZlbmRvciA/PyBudWxsO1xyXG5cclxuICAgIGNvbnN0IGluZmVycmVkQ2F0ZWdvcnkgPSBhd2FpdCBpbmZlckNhdGVnb3J5RnJvbVJ1bGVzKFxyXG4gICAgICB1c2VyLmlkLFxyXG4gICAgICB2ZW5kb3JWYWx1ZSxcclxuICAgICAgY29tYmluZWRUZXh0XHJcbiAgICApO1xyXG5cclxuICAgIHJvd3NUb0luc2VydC5wdXNoKHtcclxuICAgICAgdXNlcl9pZDogdXNlci5pZCxcclxuICAgICAgc291cmNlOiBcImdtYWlsXCIsXHJcbiAgICAgIGFtb3VudDogZmluYWxQYXJzZWQuYW1vdW50LFxyXG4gICAgICBjdXJyZW5jeTogZmluYWxQYXJzZWQuY3VycmVuY3kgPz8gXCJVU0RcIixcclxuICAgICAgdmVuZG9yOiB2ZW5kb3JWYWx1ZSxcclxuICAgICAgZGF0ZTogZmluYWxQYXJzZWQuZGF0ZSA/PyBkYXRlSGVhZGVyID8/IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgaW52b2ljZV9wZGZfdXJsOiBwZGZVcmxzWzBdID8/IG51bGwsXHJcbiAgICAgIGNhdGVnb3J5OiBpbmZlcnJlZENhdGVnb3J5LFxyXG4gICAgICBjb25maWRlbmNlX3Njb3JlOiBmaW5hbENvbmZpZGVuY2UsXHJcbiAgICAgIHJhd190ZXh0OiBjb21iaW5lZFRleHQsXHJcbiAgICAgIHJlZmVyZW5jZV9pZDogZmluYWxQYXJzZWQucmVmZXJlbmNlSWQgPz8gaWRcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgaWYgKHJvd3NUb0luc2VydC5sZW5ndGggPT09IDApIHtcclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGluc2VydGVkOiAwLCBwZGZzU3RvcmVkLCB0b3RhbEZvclVzZXI6IDAgfSk7XHJcbiAgfVxyXG5cclxuICBjb25zdCB7IGVycm9yOiBpbnNlcnRFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VTZXJ2ZXJcclxuICAgIC5mcm9tKFwidHJhbnNhY3Rpb25zXCIpXHJcbiAgICAuaW5zZXJ0KHJvd3NUb0luc2VydCk7XHJcblxyXG4gIGlmIChpbnNlcnRFcnJvcikge1xyXG4gICAgbG9nUGFyc2VFcnJvcihcImdtYWlsXCIsIFwiRmFpbGVkIHRvIGluc2VydCBHbWFpbCB0cmFuc2FjdGlvbnNcIiwge1xyXG4gICAgICBlcnJvcjogaW5zZXJ0RXJyb3IubWVzc2FnZVxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgIHsgZXJyb3I6IFwiRmFpbGVkIHRvIGluc2VydCBHbWFpbCB0cmFuc2FjdGlvbnNcIiB9LFxyXG4gICAgICB7IHN0YXR1czogNTAwIH1cclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBjb25zdCB7IGNvdW50IH0gPSBhd2FpdCBzdXBhYmFzZVNlcnZlclxyXG4gICAgLmZyb20oXCJ0cmFuc2FjdGlvbnNcIilcclxuICAgIC5zZWxlY3QoXCJpZFwiLCB7IGNvdW50OiBcImV4YWN0XCIsIGhlYWQ6IHRydWUgfSlcclxuICAgIC5lcShcInVzZXJfaWRcIiwgdXNlci5pZCk7XHJcblxyXG4gIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XHJcbiAgICBpbnNlcnRlZDogcm93c1RvSW5zZXJ0Lmxlbmd0aCxcclxuICAgIHBkZnNTdG9yZWQsXHJcbiAgICB0b3RhbEZvclVzZXI6IHR5cGVvZiBjb3VudCA9PT0gXCJudW1iZXJcIiA/IGNvdW50IDogbnVsbFxyXG4gIH0pO1xyXG59XHJcbiJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJzdXBhYmFzZVNlcnZlciIsImdldFVzZXJGcm9tUmVxdWVzdCIsImRlY3J5cHRUb2tlbiIsImVuY3J5cHRUb2tlbiIsInJlZ2V4UGFyc2VUcmFuc2FjdGlvbiIsImxvZ1BhcnNlRXJyb3IiLCJpbmZlckNhdGVnb3J5RnJvbVJ1bGVzIiwicnVudGltZSIsImVuc3VyZUFjY2Vzc1Rva2VuIiwicmVjb3JkIiwiY2xpZW50SWQiLCJwcm9jZXNzIiwiZW52IiwiR09PR0xFX09BVVRIX0NMSUVOVF9JRCIsImNsaWVudFNlY3JldCIsIkdPT0dMRV9PQVVUSF9DTElFTlRfU0VDUkVUIiwiZXJyb3IiLCJub3ciLCJEYXRlIiwiZXhwaXJ5TXMiLCJleHBpcnlfZGF0ZSIsImdldFRpbWUiLCJhY2Nlc3NUb2tlbiIsImFjY2Vzc190b2tlbiIsInJlZnJlc2hfdG9rZW4iLCJyZWZyZXNoUmVzIiwiZmV0Y2giLCJtZXRob2QiLCJoZWFkZXJzIiwiYm9keSIsIlVSTFNlYXJjaFBhcmFtcyIsImNsaWVudF9pZCIsImNsaWVudF9zZWNyZXQiLCJncmFudF90eXBlIiwidG9TdHJpbmciLCJvayIsInRleHQiLCJqc29uIiwibmV3QWNjZXNzVG9rZW4iLCJleHBpcnlEYXRlIiwiZXhwaXJlc19pbiIsInRvSVNPU3RyaW5nIiwiZnJvbSIsInVwZGF0ZSIsImVxIiwiaWQiLCJtZXNzYWdlIiwiZGVjb2RlQmFzZTY0VXJsIiwiZGF0YSIsIm5vcm1hbGl6ZWQiLCJyZXBsYWNlIiwiYnVmZiIsIkJ1ZmZlciIsImRlY29kZUJhc2U2NFVybFRvQnVmZmVyIiwiZXh0cmFjdEVtYWlsVGV4dCIsInBheWxvYWQiLCJwYXJ0c1F1ZXVlIiwidGV4dHMiLCJsZW5ndGgiLCJwYXJ0IiwicG9wIiwibWltZVR5cGUiLCJwdXNoIiwiaHRtbCIsInBhcnRzIiwiQXJyYXkiLCJpc0FycmF5Iiwiam9pbiIsImV4dHJhY3RQZGZEYXRhIiwidXNlcklkIiwibWVzc2FnZUlkIiwidXJscyIsImlzUGRmTWltZSIsInJhd0ZpbGVuYW1lIiwiZmlsZW5hbWUiLCJ0cmltIiwiaXNQZGZGaWxlbmFtZSIsInRvTG93ZXJDYXNlIiwiZW5kc1dpdGgiLCJoYXNBdHRhY2htZW50SWQiLCJhdHRhY2htZW50SWQiLCJwZGZNb2R1bGUiLCJwZGZQYXJzZSIsImRlZmF1bHQiLCJhdHRhY2hSZXMiLCJBdXRob3JpemF0aW9uIiwiYXR0YWNoSnNvbiIsImJ1ZmZlciIsInBhcnNlZCIsImJ1Y2tldCIsImZpbGVOYW1lIiwicGF0aCIsInVwbG9hZEVycm9yIiwic3RvcmFnZSIsInVwbG9hZCIsInVwc2VydCIsImNvbnRlbnRUeXBlIiwicHVibGljRGF0YSIsImdldFB1YmxpY1VybCIsInB1YmxpY1VybCIsInN0b3JhZ2VFcnIiLCJTdHJpbmciLCJlcnIiLCJ0ZXh0c0NvdW50IiwidXJsc0NvdW50IiwiZXh0cmFjdERhdGVGcm9tSGVhZGVycyIsImgiLCJmaW5kIiwieCIsIm5hbWUiLCJ2YWx1ZSIsImQiLCJOdW1iZXIiLCJpc05hTiIsImV4dHJhY3RIZWFkZXJWYWx1ZSIsImV4dHJhY3RWZW5kb3JGcm9tSGVhZGVycyIsInN1YmplY3QiLCJxdW90ZWQiLCJtYXRjaCIsImFuZ2xlZCIsImJlZm9yZUFuZ2xlIiwic3BsaXQiLCJjbGVhbmVkIiwiUE9TVCIsInJlcXVlc3QiLCJ1c2VyIiwic3RhdHVzIiwidG9rZW5SZWNvcmQiLCJ0b2tlbkVycm9yIiwic2VsZWN0IiwibWF5YmVTaW5nbGUiLCJlbnN1cmVkIiwic2VhcmNoUXVlcnkiLCJwYXJhbXMiLCJxIiwibWF4UmVzdWx0cyIsImxpc3RSZXMiLCJsaXN0SnNvbiIsIm1lc3NhZ2VzIiwiaW5zZXJ0ZWQiLCJiYXNlQXBwVXJsIiwiTkVYVF9QVUJMSUNfQVBQX1VSTCIsInJvd3NUb0luc2VydCIsInBkZnNTdG9yZWQiLCJtc2dSZXMiLCJtc2dKc29uIiwiZGF0ZUhlYWRlciIsImJvZHlUZXh0IiwicGRmVGV4dHMiLCJwZGZVcmxzIiwiY29tYmluZWRUZXh0IiwiY29uZmlkZW5jZSIsImZpbmFsUGFyc2VkIiwiZmluYWxDb25maWRlbmNlIiwiYW1vdW50IiwibGxtUmVzIiwiSlNPTiIsInN0cmluZ2lmeSIsImxsbUpzb24iLCJoZWFkZXJWZW5kb3IiLCJ2ZW5kb3JWYWx1ZSIsInZlbmRvciIsImluZmVycmVkQ2F0ZWdvcnkiLCJ1c2VyX2lkIiwic291cmNlIiwiY3VycmVuY3kiLCJkYXRlIiwiaW52b2ljZV9wZGZfdXJsIiwiY2F0ZWdvcnkiLCJjb25maWRlbmNlX3Njb3JlIiwicmF3X3RleHQiLCJyZWZlcmVuY2VfaWQiLCJyZWZlcmVuY2VJZCIsInRvdGFsRm9yVXNlciIsImluc2VydEVycm9yIiwiaW5zZXJ0IiwiY291bnQiLCJoZWFkIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/gmail/sync/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/auth.ts":
/*!*************************!*\
  !*** ./src/lib/auth.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getUserFromRequest: () => (/* binding */ getUserFromRequest)\n/* harmony export */ });\n/* harmony import */ var _supabaseServer__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./supabaseServer */ \"(rsc)/./src/lib/supabaseServer.ts\");\n\nasync function getUserFromRequest(req) {\n    const header = req.headers.get(\"authorization\") || req.headers.get(\"Authorization\");\n    if (!header || !header.startsWith(\"Bearer \")) {\n        return null;\n    }\n    const token = header.slice(\"Bearer \".length).trim();\n    const { data, error } = await _supabaseServer__WEBPACK_IMPORTED_MODULE_0__.supabaseServer.auth.getUser(token);\n    if (error || !data.user) {\n        return null;\n    }\n    return data.user;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2F1dGgudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFDa0Q7QUFFM0MsZUFBZUMsbUJBQW1CQyxHQUFnQjtJQUN2RCxNQUFNQyxTQUFTRCxJQUFJRSxPQUFPLENBQUNDLEdBQUcsQ0FBQyxvQkFBb0JILElBQUlFLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDO0lBQ25FLElBQUksQ0FBQ0YsVUFBVSxDQUFDQSxPQUFPRyxVQUFVLENBQUMsWUFBWTtRQUM1QyxPQUFPO0lBQ1Q7SUFDQSxNQUFNQyxRQUFRSixPQUFPSyxLQUFLLENBQUMsVUFBVUMsTUFBTSxFQUFFQyxJQUFJO0lBQ2pELE1BQU0sRUFBRUMsSUFBSSxFQUFFQyxLQUFLLEVBQUUsR0FBRyxNQUFNWiwyREFBY0EsQ0FBQ2EsSUFBSSxDQUFDQyxPQUFPLENBQUNQO0lBQzFELElBQUlLLFNBQVMsQ0FBQ0QsS0FBS0ksSUFBSSxFQUFFO1FBQ3ZCLE9BQU87SUFDVDtJQUNBLE9BQU9KLEtBQUtJLElBQUk7QUFDbEIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9leHBlbnNlLXRyYWNrZXIvLi9zcmMvbGliL2F1dGgudHM/NjY5MiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVxdWVzdCB9IGZyb20gXCJuZXh0L3NlcnZlclwiO1xyXG5pbXBvcnQgeyBzdXBhYmFzZVNlcnZlciB9IGZyb20gXCIuL3N1cGFiYXNlU2VydmVyXCI7XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0VXNlckZyb21SZXF1ZXN0KHJlcTogTmV4dFJlcXVlc3QpIHtcclxuICBjb25zdCBoZWFkZXIgPSByZXEuaGVhZGVycy5nZXQoXCJhdXRob3JpemF0aW9uXCIpIHx8IHJlcS5oZWFkZXJzLmdldChcIkF1dGhvcml6YXRpb25cIik7XHJcbiAgaWYgKCFoZWFkZXIgfHwgIWhlYWRlci5zdGFydHNXaXRoKFwiQmVhcmVyIFwiKSkge1xyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG4gIGNvbnN0IHRva2VuID0gaGVhZGVyLnNsaWNlKFwiQmVhcmVyIFwiLmxlbmd0aCkudHJpbSgpO1xyXG4gIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlU2VydmVyLmF1dGguZ2V0VXNlcih0b2tlbik7XHJcbiAgaWYgKGVycm9yIHx8ICFkYXRhLnVzZXIpIHtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuICByZXR1cm4gZGF0YS51c2VyO1xyXG59XHJcbiJdLCJuYW1lcyI6WyJzdXBhYmFzZVNlcnZlciIsImdldFVzZXJGcm9tUmVxdWVzdCIsInJlcSIsImhlYWRlciIsImhlYWRlcnMiLCJnZXQiLCJzdGFydHNXaXRoIiwidG9rZW4iLCJzbGljZSIsImxlbmd0aCIsInRyaW0iLCJkYXRhIiwiZXJyb3IiLCJhdXRoIiwiZ2V0VXNlciIsInVzZXIiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/auth.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/gmailCrypto.ts":
/*!********************************!*\
  !*** ./src/lib/gmailCrypto.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   decryptToken: () => (/* binding */ decryptToken),\n/* harmony export */   encryptToken: () => (/* binding */ encryptToken)\n/* harmony export */ });\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_0__);\n\nconst SECRET = process.env.GMAIL_ENCRYPTION_KEY;\nif (!SECRET) {\n    throw new Error(\"GMAIL_ENCRYPTION_KEY is not set\");\n}\nconst KEY = crypto__WEBPACK_IMPORTED_MODULE_0___default().createHash(\"sha256\").update(SECRET).digest();\nconst IV_LENGTH = 12; // AES-GCM recommended IV length\nfunction encryptToken(plain) {\n    const iv = crypto__WEBPACK_IMPORTED_MODULE_0___default().randomBytes(IV_LENGTH);\n    const cipher = crypto__WEBPACK_IMPORTED_MODULE_0___default().createCipheriv(\"aes-256-gcm\", KEY, iv);\n    const enc = Buffer.concat([\n        cipher.update(plain, \"utf8\"),\n        cipher.final()\n    ]);\n    const tag = cipher.getAuthTag();\n    return Buffer.concat([\n        iv,\n        tag,\n        enc\n    ]).toString(\"base64\");\n}\nfunction decryptToken(payload) {\n    const data = Buffer.from(payload, \"base64\");\n    const iv = data.subarray(0, IV_LENGTH);\n    const tag = data.subarray(IV_LENGTH, IV_LENGTH + 16);\n    const enc = data.subarray(IV_LENGTH + 16);\n    const decipher = crypto__WEBPACK_IMPORTED_MODULE_0___default().createDecipheriv(\"aes-256-gcm\", KEY, iv);\n    decipher.setAuthTag(tag);\n    const dec = Buffer.concat([\n        decipher.update(enc),\n        decipher.final()\n    ]);\n    return dec.toString(\"utf8\");\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2dtYWlsQ3J5cHRvLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBNEI7QUFFNUIsTUFBTUMsU0FBU0MsUUFBUUMsR0FBRyxDQUFDQyxvQkFBb0I7QUFFL0MsSUFBSSxDQUFDSCxRQUFRO0lBQ1gsTUFBTSxJQUFJSSxNQUFNO0FBQ2xCO0FBRUEsTUFBTUMsTUFBTU4sd0RBQWlCLENBQUMsVUFBVVEsTUFBTSxDQUFDUCxRQUFRUSxNQUFNO0FBQzdELE1BQU1DLFlBQVksSUFBSSxnQ0FBZ0M7QUFFL0MsU0FBU0MsYUFBYUMsS0FBYTtJQUN4QyxNQUFNQyxLQUFLYix5REFBa0IsQ0FBQ1U7SUFDOUIsTUFBTUssU0FBU2YsNERBQXFCLENBQUMsZUFBZU0sS0FBS087SUFDekQsTUFBTUksTUFBTUMsT0FBT0MsTUFBTSxDQUFDO1FBQUNKLE9BQU9QLE1BQU0sQ0FBQ0ksT0FBTztRQUFTRyxPQUFPSyxLQUFLO0tBQUc7SUFDeEUsTUFBTUMsTUFBTU4sT0FBT08sVUFBVTtJQUM3QixPQUFPSixPQUFPQyxNQUFNLENBQUM7UUFBQ047UUFBSVE7UUFBS0o7S0FBSSxFQUFFTSxRQUFRLENBQUM7QUFDaEQ7QUFFTyxTQUFTQyxhQUFhQyxPQUFlO0lBQzFDLE1BQU1DLE9BQU9SLE9BQU9TLElBQUksQ0FBQ0YsU0FBUztJQUNsQyxNQUFNWixLQUFLYSxLQUFLRSxRQUFRLENBQUMsR0FBR2xCO0lBQzVCLE1BQU1XLE1BQU1LLEtBQUtFLFFBQVEsQ0FBQ2xCLFdBQVdBLFlBQVk7SUFDakQsTUFBTU8sTUFBTVMsS0FBS0UsUUFBUSxDQUFDbEIsWUFBWTtJQUN0QyxNQUFNbUIsV0FBVzdCLDhEQUF1QixDQUFDLGVBQWVNLEtBQUtPO0lBQzdEZ0IsU0FBU0UsVUFBVSxDQUFDVjtJQUNwQixNQUFNVyxNQUFNZCxPQUFPQyxNQUFNLENBQUM7UUFBQ1UsU0FBU3JCLE1BQU0sQ0FBQ1M7UUFBTVksU0FBU1QsS0FBSztLQUFHO0lBQ2xFLE9BQU9ZLElBQUlULFFBQVEsQ0FBQztBQUN0QiIsInNvdXJjZXMiOlsid2VicGFjazovL2V4cGVuc2UtdHJhY2tlci8uL3NyYy9saWIvZ21haWxDcnlwdG8udHM/MmViYiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgY3J5cHRvIGZyb20gXCJjcnlwdG9cIjtcclxuXHJcbmNvbnN0IFNFQ1JFVCA9IHByb2Nlc3MuZW52LkdNQUlMX0VOQ1JZUFRJT05fS0VZO1xyXG5cclxuaWYgKCFTRUNSRVQpIHtcclxuICB0aHJvdyBuZXcgRXJyb3IoXCJHTUFJTF9FTkNSWVBUSU9OX0tFWSBpcyBub3Qgc2V0XCIpO1xyXG59XHJcblxyXG5jb25zdCBLRVkgPSBjcnlwdG8uY3JlYXRlSGFzaChcInNoYTI1NlwiKS51cGRhdGUoU0VDUkVUKS5kaWdlc3QoKTtcclxuY29uc3QgSVZfTEVOR1RIID0gMTI7IC8vIEFFUy1HQ00gcmVjb21tZW5kZWQgSVYgbGVuZ3RoXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZW5jcnlwdFRva2VuKHBsYWluOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gIGNvbnN0IGl2ID0gY3J5cHRvLnJhbmRvbUJ5dGVzKElWX0xFTkdUSCk7XHJcbiAgY29uc3QgY2lwaGVyID0gY3J5cHRvLmNyZWF0ZUNpcGhlcml2KFwiYWVzLTI1Ni1nY21cIiwgS0VZLCBpdik7XHJcbiAgY29uc3QgZW5jID0gQnVmZmVyLmNvbmNhdChbY2lwaGVyLnVwZGF0ZShwbGFpbiwgXCJ1dGY4XCIpLCBjaXBoZXIuZmluYWwoKV0pO1xyXG4gIGNvbnN0IHRhZyA9IGNpcGhlci5nZXRBdXRoVGFnKCk7XHJcbiAgcmV0dXJuIEJ1ZmZlci5jb25jYXQoW2l2LCB0YWcsIGVuY10pLnRvU3RyaW5nKFwiYmFzZTY0XCIpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZGVjcnlwdFRva2VuKHBheWxvYWQ6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgY29uc3QgZGF0YSA9IEJ1ZmZlci5mcm9tKHBheWxvYWQsIFwiYmFzZTY0XCIpO1xyXG4gIGNvbnN0IGl2ID0gZGF0YS5zdWJhcnJheSgwLCBJVl9MRU5HVEgpO1xyXG4gIGNvbnN0IHRhZyA9IGRhdGEuc3ViYXJyYXkoSVZfTEVOR1RILCBJVl9MRU5HVEggKyAxNik7XHJcbiAgY29uc3QgZW5jID0gZGF0YS5zdWJhcnJheShJVl9MRU5HVEggKyAxNik7XHJcbiAgY29uc3QgZGVjaXBoZXIgPSBjcnlwdG8uY3JlYXRlRGVjaXBoZXJpdihcImFlcy0yNTYtZ2NtXCIsIEtFWSwgaXYpO1xyXG4gIGRlY2lwaGVyLnNldEF1dGhUYWcodGFnKTtcclxuICBjb25zdCBkZWMgPSBCdWZmZXIuY29uY2F0KFtkZWNpcGhlci51cGRhdGUoZW5jKSwgZGVjaXBoZXIuZmluYWwoKV0pO1xyXG4gIHJldHVybiBkZWMudG9TdHJpbmcoXCJ1dGY4XCIpO1xyXG59XHJcbiJdLCJuYW1lcyI6WyJjcnlwdG8iLCJTRUNSRVQiLCJwcm9jZXNzIiwiZW52IiwiR01BSUxfRU5DUllQVElPTl9LRVkiLCJFcnJvciIsIktFWSIsImNyZWF0ZUhhc2giLCJ1cGRhdGUiLCJkaWdlc3QiLCJJVl9MRU5HVEgiLCJlbmNyeXB0VG9rZW4iLCJwbGFpbiIsIml2IiwicmFuZG9tQnl0ZXMiLCJjaXBoZXIiLCJjcmVhdGVDaXBoZXJpdiIsImVuYyIsIkJ1ZmZlciIsImNvbmNhdCIsImZpbmFsIiwidGFnIiwiZ2V0QXV0aFRhZyIsInRvU3RyaW5nIiwiZGVjcnlwdFRva2VuIiwicGF5bG9hZCIsImRhdGEiLCJmcm9tIiwic3ViYXJyYXkiLCJkZWNpcGhlciIsImNyZWF0ZURlY2lwaGVyaXYiLCJzZXRBdXRoVGFnIiwiZGVjIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/gmailCrypto.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/logging.ts":
/*!****************************!*\
  !*** ./src/lib/logging.ts ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   logParseError: () => (/* binding */ logParseError)\n/* harmony export */ });\nfunction logParseError(source, message, context) {\n    // Simple logging hook; can be wired to Sentry using SENTRY_DSN later.\n    // For now, log to stderr so failures are visible in logs.\n    // eslint-disable-next-line no-console\n    console.error(`[ParseError][${source}] ${message}`, context);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2xvZ2dpbmcudHMiLCJtYXBwaW5ncyI6Ijs7OztBQUVPLFNBQVNBLGNBQWNDLE1BQWMsRUFBRUMsT0FBZSxFQUFFQyxPQUFvQjtJQUNqRixzRUFBc0U7SUFDdEUsMERBQTBEO0lBQzFELHNDQUFzQztJQUN0Q0MsUUFBUUMsS0FBSyxDQUFDLENBQUMsYUFBYSxFQUFFSixPQUFPLEVBQUUsRUFBRUMsUUFBUSxDQUFDLEVBQUVDO0FBQ3REIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZXhwZW5zZS10cmFja2VyLy4vc3JjL2xpYi9sb2dnaW5nLnRzP2FlMGYiXSwic291cmNlc0NvbnRlbnQiOlsidHlwZSBMb2dDb250ZXh0ID0gUmVjb3JkPHN0cmluZywgdW5rbm93bj4gfCB1bmRlZmluZWQ7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gbG9nUGFyc2VFcnJvcihzb3VyY2U6IHN0cmluZywgbWVzc2FnZTogc3RyaW5nLCBjb250ZXh0PzogTG9nQ29udGV4dCkge1xyXG4gIC8vIFNpbXBsZSBsb2dnaW5nIGhvb2s7IGNhbiBiZSB3aXJlZCB0byBTZW50cnkgdXNpbmcgU0VOVFJZX0RTTiBsYXRlci5cclxuICAvLyBGb3Igbm93LCBsb2cgdG8gc3RkZXJyIHNvIGZhaWx1cmVzIGFyZSB2aXNpYmxlIGluIGxvZ3MuXHJcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnNvbGVcclxuICBjb25zb2xlLmVycm9yKGBbUGFyc2VFcnJvcl1bJHtzb3VyY2V9XSAke21lc3NhZ2V9YCwgY29udGV4dCk7XHJcbn1cclxuIl0sIm5hbWVzIjpbImxvZ1BhcnNlRXJyb3IiLCJzb3VyY2UiLCJtZXNzYWdlIiwiY29udGV4dCIsImNvbnNvbGUiLCJlcnJvciJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/logging.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/parsing/transactionParser.ts":
/*!**********************************************!*\
  !*** ./src/lib/parsing/transactionParser.ts ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   regexParseTransaction: () => (/* binding */ regexParseTransaction)\n/* harmony export */ });\nconst amountRegex = /(\\d{1,3}(?:[,\\.\\s]\\d{3})*(?:[\\.,]\\d{2}))/;\nconst currencyRegex = /\\b(USD|EUR|GBP|NGN|KES|ZAR|CAD|AUD|INR|JPY|CNY|CHF|SEK|NOK|DKK|RUB|BRL|USD\\$|US\\$|\\$||)\\b/i;\nconst dateRegex = /(\\d{4}-\\d{2}-\\d{2}|(?:\\d{1,2}[\\/\\-.]){2}\\d{2,4}|\\b(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Sept|Oct|Nov|Dec)[a-z]*\\s+\\d{1,2},?\\s+\\d{2,4})/i;\nfunction normalizeAmount(raw) {\n    const cleaned = raw.replace(/[^0-9.,]/g, \"\");\n    if (!cleaned) return undefined;\n    if (cleaned.includes(\",\") && cleaned.includes(\".\")) {\n        const lastDot = cleaned.lastIndexOf(\".\");\n        const lastComma = cleaned.lastIndexOf(\",\");\n        const decimalSep = lastDot > lastComma ? \".\" : \",\";\n        const thousandsSep = decimalSep === \".\" ? \",\" : \".\";\n        const noThousands = cleaned.replace(new RegExp(`\\\\${thousandsSep}`, \"g\"), \"\");\n        const normalized = decimalSep === \",\" ? noThousands.replace(\",\", \".\") : noThousands;\n        const value = Number(normalized);\n        return Number.isFinite(value) ? value : undefined;\n    }\n    if (cleaned.includes(\",\") && !cleaned.includes(\".\")) {\n        const normalized = cleaned.replace(/\\./g, \"\").replace(\",\", \".\");\n        const value = Number(normalized);\n        return Number.isFinite(value) ? value : undefined;\n    }\n    const value = Number(cleaned.replace(/,/g, \"\"));\n    return Number.isFinite(value) ? value : undefined;\n}\nfunction parseDate(raw) {\n    const trimmed = raw.trim();\n    if (/^\\d{4}-\\d{2}-\\d{2}$/.test(trimmed)) {\n        const d = new Date(trimmed + \"T00:00:00Z\");\n        return Number.isNaN(d.getTime()) ? undefined : d.toISOString();\n    }\n    if (/^(?:\\d{1,2}[\\/\\-.]){2}\\d{2,4}$/.test(trimmed)) {\n        const [aStr, bStr, cStr] = trimmed.split(/[\\/\\-.]/);\n        let a = Number(aStr);\n        let b = Number(bStr);\n        let c = Number(cStr);\n        if (c < 100) c += 2000;\n        const day = a > 12 ? a : b;\n        const month = a > 12 ? b : a;\n        const d = new Date(Date.UTC(c, month - 1, day));\n        return Number.isNaN(d.getTime()) ? undefined : d.toISOString();\n    }\n    const d = new Date(trimmed);\n    return Number.isNaN(d.getTime()) ? undefined : d.toISOString();\n}\nfunction extractVendor(text) {\n    const atMatch = text.match(/\\bat\\s+([A-Za-z0-9&'().\\-\\s]{2,60})/i);\n    if (atMatch) return atMatch[1].trim();\n    const fromMatch = text.match(/\\bfrom\\s+([A-Za-z0-9&'().\\-\\s]{2,60})/i);\n    if (fromMatch) return fromMatch[1].trim();\n    const toMatch = text.match(/\\bto\\s+([A-Za-z0-9&'().\\-\\s]{2,60})/i);\n    if (toMatch) return toMatch[1].trim();\n    const lineMatch = text.split(/\\r?\\n/).find((line)=>/receipt|transaction|payment|order/i.test(line));\n    if (lineMatch) {\n        const cleaned = lineMatch.replace(/receipt|transaction|payment|order/gi, \"\");\n        const candidate = cleaned.replace(/[:#]/g, \"\").trim();\n        if (candidate.length >= 2 && candidate.length <= 60) return candidate;\n    }\n    return undefined;\n}\nfunction extractReferenceId(text) {\n    const refMatch = text.match(/\\b(?:ref(?:erence)?|txn|transaction id|transaction no\\.)[:\\s]+([A-Za-z0-9\\-]{4,})/i);\n    return refMatch ? refMatch[1].trim() : undefined;\n}\nfunction regexParseTransaction(text) {\n    const amountMatch = text.match(amountRegex);\n    const currencyMatch = text.match(currencyRegex);\n    const dateMatch = text.match(dateRegex);\n    const amount = amountMatch ? normalizeAmount(amountMatch[1]) : undefined;\n    const currencyRaw = currencyMatch ? currencyMatch[1].toUpperCase() : undefined;\n    let currency;\n    if (currencyRaw) {\n        if ([\n            \"$\",\n            \"USD$\",\n            \"US$\"\n        ].includes(currencyRaw)) currency = \"USD\";\n        else if (currencyRaw === \"\") currency = \"EUR\";\n        else if (currencyRaw === \"\\xa3\") currency = \"GBP\";\n        else currency = currencyRaw;\n    }\n    const date = dateMatch ? parseDate(dateMatch[1]) : undefined;\n    const vendor = extractVendor(text);\n    const referenceId = extractReferenceId(text);\n    let confidence = 0.3;\n    if (amount && date && vendor) confidence = 0.95;\n    else if (amount && date) confidence = 0.9;\n    else if (amount) confidence = 0.7;\n    return {\n        parsed: {\n            amount,\n            currency,\n            vendor,\n            date,\n            referenceId\n        },\n        confidence\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3BhcnNpbmcvdHJhbnNhY3Rpb25QYXJzZXIudHMiLCJtYXBwaW5ncyI6Ijs7OztBQVFBLE1BQU1BLGNBQWM7QUFDcEIsTUFBTUMsZ0JBQWdCO0FBQ3RCLE1BQU1DLFlBQVk7QUFFbEIsU0FBU0MsZ0JBQWdCQyxHQUFXO0lBQ2xDLE1BQU1DLFVBQVVELElBQUlFLE9BQU8sQ0FBQyxhQUFhO0lBQ3pDLElBQUksQ0FBQ0QsU0FBUyxPQUFPRTtJQUVyQixJQUFJRixRQUFRRyxRQUFRLENBQUMsUUFBUUgsUUFBUUcsUUFBUSxDQUFDLE1BQU07UUFDbEQsTUFBTUMsVUFBVUosUUFBUUssV0FBVyxDQUFDO1FBQ3BDLE1BQU1DLFlBQVlOLFFBQVFLLFdBQVcsQ0FBQztRQUN0QyxNQUFNRSxhQUFhSCxVQUFVRSxZQUFZLE1BQU07UUFDL0MsTUFBTUUsZUFBZUQsZUFBZSxNQUFNLE1BQU07UUFDaEQsTUFBTUUsY0FBY1QsUUFBUUMsT0FBTyxDQUFDLElBQUlTLE9BQU8sQ0FBQyxFQUFFLEVBQUVGLGFBQWEsQ0FBQyxFQUFFLE1BQU07UUFDMUUsTUFBTUcsYUFBYUosZUFBZSxNQUFNRSxZQUFZUixPQUFPLENBQUMsS0FBSyxPQUFPUTtRQUN4RSxNQUFNRyxRQUFRQyxPQUFPRjtRQUNyQixPQUFPRSxPQUFPQyxRQUFRLENBQUNGLFNBQVNBLFFBQVFWO0lBQzFDO0lBRUEsSUFBSUYsUUFBUUcsUUFBUSxDQUFDLFFBQVEsQ0FBQ0gsUUFBUUcsUUFBUSxDQUFDLE1BQU07UUFDbkQsTUFBTVEsYUFBYVgsUUFBUUMsT0FBTyxDQUFDLE9BQU8sSUFBSUEsT0FBTyxDQUFDLEtBQUs7UUFDM0QsTUFBTVcsUUFBUUMsT0FBT0Y7UUFDckIsT0FBT0UsT0FBT0MsUUFBUSxDQUFDRixTQUFTQSxRQUFRVjtJQUMxQztJQUVBLE1BQU1VLFFBQVFDLE9BQU9iLFFBQVFDLE9BQU8sQ0FBQyxNQUFNO0lBQzNDLE9BQU9ZLE9BQU9DLFFBQVEsQ0FBQ0YsU0FBU0EsUUFBUVY7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LE9BQU9MLFlBQVluQyxVQUFVbUMsU0FBUyxDQUFDLEVBQUUsSUFBSWhEO0lBQ25ELE1BQU1zRCxTQUFTdEIsY0FBY0M7SUFDN0IsTUFBTXNCLGNBQWNaLG1CQUFtQlY7SUFFdkMsSUFBSXVCLGFBQWE7SUFDakIsSUFBSVAsVUFBVUksUUFBUUMsUUFBUUUsYUFBYTtTQUN0QyxJQUFJUCxVQUFVSSxNQUFNRyxhQUFhO1NBQ2pDLElBQUlQLFFBQVFPLGFBQWE7SUFFOUIsT0FBTztRQUNMQyxRQUFRO1lBQ05SO1lBQ0FHO1lBQ0FFO1lBQ0FEO1lBQ0FFO1FBQ0Y7UUFDQUM7SUFDRjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZXhwZW5zZS10cmFja2VyLy4vc3JjL2xpYi9wYXJzaW5nL3RyYW5zYWN0aW9uUGFyc2VyLnRzPzA2YzYiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IHR5cGUgUGFyc2VkVHJhbnNhY3Rpb24gPSB7XHJcbiAgYW1vdW50PzogbnVtYmVyO1xyXG4gIGN1cnJlbmN5Pzogc3RyaW5nO1xyXG4gIHZlbmRvcj86IHN0cmluZztcclxuICBkYXRlPzogc3RyaW5nO1xyXG4gIHJlZmVyZW5jZUlkPzogc3RyaW5nO1xyXG59O1xyXG5cclxuY29uc3QgYW1vdW50UmVnZXggPSAvKFxcZHsxLDN9KD86WyxcXC5cXHNdXFxkezN9KSooPzpbXFwuLF1cXGR7Mn0pKS87XHJcbmNvbnN0IGN1cnJlbmN5UmVnZXggPSAvXFxiKFVTRHxFVVJ8R0JQfE5HTnxLRVN8WkFSfENBRHxBVUR8SU5SfEpQWXxDTll8Q0hGfFNFS3xOT0t8REtLfFJVQnxCUkx8VVNEXFwkfFVTXFwkfFxcJHzigqx8wqMpXFxiL2k7XHJcbmNvbnN0IGRhdGVSZWdleCA9IC8oXFxkezR9LVxcZHsyfS1cXGR7Mn18KD86XFxkezEsMn1bXFwvXFwtLl0pezJ9XFxkezIsNH18XFxiKD86SmFufEZlYnxNYXJ8QXByfE1heXxKdW58SnVsfEF1Z3xTZXB8U2VwdHxPY3R8Tm92fERlYylbYS16XSpcXHMrXFxkezEsMn0sP1xccytcXGR7Miw0fSkvaTtcclxuXHJcbmZ1bmN0aW9uIG5vcm1hbGl6ZUFtb3VudChyYXc6IHN0cmluZyk6IG51bWJlciB8IHVuZGVmaW5lZCB7XHJcbiAgY29uc3QgY2xlYW5lZCA9IHJhdy5yZXBsYWNlKC9bXjAtOS4sXS9nLCBcIlwiKTtcclxuICBpZiAoIWNsZWFuZWQpIHJldHVybiB1bmRlZmluZWQ7XHJcblxyXG4gIGlmIChjbGVhbmVkLmluY2x1ZGVzKFwiLFwiKSAmJiBjbGVhbmVkLmluY2x1ZGVzKFwiLlwiKSkge1xyXG4gICAgY29uc3QgbGFzdERvdCA9IGNsZWFuZWQubGFzdEluZGV4T2YoXCIuXCIpO1xyXG4gICAgY29uc3QgbGFzdENvbW1hID0gY2xlYW5lZC5sYXN0SW5kZXhPZihcIixcIik7XHJcbiAgICBjb25zdCBkZWNpbWFsU2VwID0gbGFzdERvdCA+IGxhc3RDb21tYSA/IFwiLlwiIDogXCIsXCI7XHJcbiAgICBjb25zdCB0aG91c2FuZHNTZXAgPSBkZWNpbWFsU2VwID09PSBcIi5cIiA/IFwiLFwiIDogXCIuXCI7XHJcbiAgICBjb25zdCBub1Rob3VzYW5kcyA9IGNsZWFuZWQucmVwbGFjZShuZXcgUmVnRXhwKGBcXFxcJHt0aG91c2FuZHNTZXB9YCwgXCJnXCIpLCBcIlwiKTtcclxuICAgIGNvbnN0IG5vcm1hbGl6ZWQgPSBkZWNpbWFsU2VwID09PSBcIixcIiA/IG5vVGhvdXNhbmRzLnJlcGxhY2UoXCIsXCIsIFwiLlwiKSA6IG5vVGhvdXNhbmRzO1xyXG4gICAgY29uc3QgdmFsdWUgPSBOdW1iZXIobm9ybWFsaXplZCk7XHJcbiAgICByZXR1cm4gTnVtYmVyLmlzRmluaXRlKHZhbHVlKSA/IHZhbHVlIDogdW5kZWZpbmVkO1xyXG4gIH1cclxuXHJcbiAgaWYgKGNsZWFuZWQuaW5jbHVkZXMoXCIsXCIpICYmICFjbGVhbmVkLmluY2x1ZGVzKFwiLlwiKSkge1xyXG4gICAgY29uc3Qgbm9ybWFsaXplZCA9IGNsZWFuZWQucmVwbGFjZSgvXFwuL2csIFwiXCIpLnJlcGxhY2UoXCIsXCIsIFwiLlwiKTtcclxuICAgIGNvbnN0IHZhbHVlID0gTnVtYmVyKG5vcm1hbGl6ZWQpO1xyXG4gICAgcmV0dXJuIE51bWJlci5pc0Zpbml0ZSh2YWx1ZSkgPyB2YWx1ZSA6IHVuZGVmaW5lZDtcclxuICB9XHJcblxyXG4gIGNvbnN0IHZhbHVlID0gTnVtYmVyKGNsZWFuZWQucmVwbGFjZSgvLC9nLCBcIlwiKSk7XHJcbiAgcmV0dXJuIE51bWJlci5pc0Zpbml0ZSh2YWx1ZSkgPyB2YWx1ZSA6IHVuZGVmaW5lZDtcclxufVxyXG5cclxuZnVuY3Rpb24gcGFyc2VEYXRlKHJhdzogc3RyaW5nKTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcclxuICBjb25zdCB0cmltbWVkID0gcmF3LnRyaW0oKTtcclxuICBpZiAoL15cXGR7NH0tXFxkezJ9LVxcZHsyfSQvLnRlc3QodHJpbW1lZCkpIHtcclxuICAgIGNvbnN0IGQgPSBuZXcgRGF0ZSh0cmltbWVkICsgXCJUMDA6MDA6MDBaXCIpO1xyXG4gICAgcmV0dXJuIE51bWJlci5pc05hTihkLmdldFRpbWUoKSkgPyB1bmRlZmluZWQgOiBkLnRvSVNPU3RyaW5nKCk7XHJcbiAgfVxyXG5cclxuICBpZiAoL14oPzpcXGR7MSwyfVtcXC9cXC0uXSl7Mn1cXGR7Miw0fSQvLnRlc3QodHJpbW1lZCkpIHtcclxuICAgIGNvbnN0IFthU3RyLCBiU3RyLCBjU3RyXSA9IHRyaW1tZWQuc3BsaXQoL1tcXC9cXC0uXS8pO1xyXG4gICAgbGV0IGEgPSBOdW1iZXIoYVN0cik7XHJcbiAgICBsZXQgYiA9IE51bWJlcihiU3RyKTtcclxuICAgIGxldCBjID0gTnVtYmVyKGNTdHIpO1xyXG4gICAgaWYgKGMgPCAxMDApIGMgKz0gMjAwMDtcclxuICAgIGNvbnN0IGRheSA9IGEgPiAxMiA/IGEgOiBiO1xyXG4gICAgY29uc3QgbW9udGggPSBhID4gMTIgPyBiIDogYTtcclxuICAgIGNvbnN0IGQgPSBuZXcgRGF0ZShEYXRlLlVUQyhjLCBtb250aCAtIDEsIGRheSkpO1xyXG4gICAgcmV0dXJuIE51bWJlci5pc05hTihkLmdldFRpbWUoKSkgPyB1bmRlZmluZWQgOiBkLnRvSVNPU3RyaW5nKCk7XHJcbiAgfVxyXG5cclxuICBjb25zdCBkID0gbmV3IERhdGUodHJpbW1lZCk7XHJcbiAgcmV0dXJuIE51bWJlci5pc05hTihkLmdldFRpbWUoKSkgPyB1bmRlZmluZWQgOiBkLnRvSVNPU3RyaW5nKCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGV4dHJhY3RWZW5kb3IodGV4dDogc3RyaW5nKTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcclxuICBjb25zdCBhdE1hdGNoID0gdGV4dC5tYXRjaCgvXFxiYXRcXHMrKFtBLVphLXowLTkmJygpLlxcLVxcc117Miw2MH0pL2kpO1xyXG4gIGlmIChhdE1hdGNoKSByZXR1cm4gYXRNYXRjaFsxXS50cmltKCk7XHJcblxyXG4gIGNvbnN0IGZyb21NYXRjaCA9IHRleHQubWF0Y2goL1xcYmZyb21cXHMrKFtBLVphLXowLTkmJygpLlxcLVxcc117Miw2MH0pL2kpO1xyXG4gIGlmIChmcm9tTWF0Y2gpIHJldHVybiBmcm9tTWF0Y2hbMV0udHJpbSgpO1xyXG5cclxuICBjb25zdCB0b01hdGNoID0gdGV4dC5tYXRjaCgvXFxidG9cXHMrKFtBLVphLXowLTkmJygpLlxcLVxcc117Miw2MH0pL2kpO1xyXG4gIGlmICh0b01hdGNoKSByZXR1cm4gdG9NYXRjaFsxXS50cmltKCk7XHJcblxyXG4gIGNvbnN0IGxpbmVNYXRjaCA9IHRleHQuc3BsaXQoL1xccj9cXG4vKS5maW5kKGxpbmUgPT4gL3JlY2VpcHR8dHJhbnNhY3Rpb258cGF5bWVudHxvcmRlci9pLnRlc3QobGluZSkpO1xyXG4gIGlmIChsaW5lTWF0Y2gpIHtcclxuICAgIGNvbnN0IGNsZWFuZWQgPSBsaW5lTWF0Y2gucmVwbGFjZSgvcmVjZWlwdHx0cmFuc2FjdGlvbnxwYXltZW50fG9yZGVyL2dpLCBcIlwiKTtcclxuICAgIGNvbnN0IGNhbmRpZGF0ZSA9IGNsZWFuZWQucmVwbGFjZSgvWzojXS9nLCBcIlwiKS50cmltKCk7XHJcbiAgICBpZiAoY2FuZGlkYXRlLmxlbmd0aCA+PSAyICYmIGNhbmRpZGF0ZS5sZW5ndGggPD0gNjApIHJldHVybiBjYW5kaWRhdGU7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gdW5kZWZpbmVkO1xyXG59XHJcblxyXG5mdW5jdGlvbiBleHRyYWN0UmVmZXJlbmNlSWQodGV4dDogc3RyaW5nKTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcclxuICBjb25zdCByZWZNYXRjaCA9IHRleHQubWF0Y2goL1xcYig/OnJlZig/OmVyZW5jZSk/fHR4bnx0cmFuc2FjdGlvbiBpZHx0cmFuc2FjdGlvbiBub1xcLilbOlxcc10rKFtBLVphLXowLTlcXC1dezQsfSkvaSk7XHJcbiAgcmV0dXJuIHJlZk1hdGNoID8gcmVmTWF0Y2hbMV0udHJpbSgpIDogdW5kZWZpbmVkO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcmVnZXhQYXJzZVRyYW5zYWN0aW9uKHRleHQ6IHN0cmluZyk6IHsgcGFyc2VkOiBQYXJzZWRUcmFuc2FjdGlvbjsgY29uZmlkZW5jZTogbnVtYmVyIH0ge1xyXG4gIGNvbnN0IGFtb3VudE1hdGNoID0gdGV4dC5tYXRjaChhbW91bnRSZWdleCk7XHJcbiAgY29uc3QgY3VycmVuY3lNYXRjaCA9IHRleHQubWF0Y2goY3VycmVuY3lSZWdleCk7XHJcbiAgY29uc3QgZGF0ZU1hdGNoID0gdGV4dC5tYXRjaChkYXRlUmVnZXgpO1xyXG5cclxuICBjb25zdCBhbW91bnQgPSBhbW91bnRNYXRjaCA/IG5vcm1hbGl6ZUFtb3VudChhbW91bnRNYXRjaFsxXSkgOiB1bmRlZmluZWQ7XHJcbiAgY29uc3QgY3VycmVuY3lSYXcgPSBjdXJyZW5jeU1hdGNoID8gY3VycmVuY3lNYXRjaFsxXS50b1VwcGVyQ2FzZSgpIDogdW5kZWZpbmVkO1xyXG5cclxuICBsZXQgY3VycmVuY3k6IHN0cmluZyB8IHVuZGVmaW5lZDtcclxuICBpZiAoY3VycmVuY3lSYXcpIHtcclxuICAgIGlmIChbXCIkXCIsIFwiVVNEJFwiLCBcIlVTJFwiXSAuaW5jbHVkZXMoY3VycmVuY3lSYXcpKSBjdXJyZW5jeSA9IFwiVVNEXCI7XHJcbiAgICBlbHNlIGlmIChjdXJyZW5jeVJhdyA9PT0gXCLigqxcIikgY3VycmVuY3kgPSBcIkVVUlwiO1xyXG4gICAgZWxzZSBpZiAoY3VycmVuY3lSYXcgPT09IFwiwqNcIikgY3VycmVuY3kgPSBcIkdCUFwiO1xyXG4gICAgZWxzZSBjdXJyZW5jeSA9IGN1cnJlbmN5UmF3O1xyXG4gIH1cclxuXHJcbiAgY29uc3QgZGF0ZSA9IGRhdGVNYXRjaCA/IHBhcnNlRGF0ZShkYXRlTWF0Y2hbMV0pIDogdW5kZWZpbmVkO1xyXG4gIGNvbnN0IHZlbmRvciA9IGV4dHJhY3RWZW5kb3IodGV4dCk7XHJcbiAgY29uc3QgcmVmZXJlbmNlSWQgPSBleHRyYWN0UmVmZXJlbmNlSWQodGV4dCk7XHJcblxyXG4gIGxldCBjb25maWRlbmNlID0gMC4zO1xyXG4gIGlmIChhbW91bnQgJiYgZGF0ZSAmJiB2ZW5kb3IpIGNvbmZpZGVuY2UgPSAwLjk1O1xyXG4gIGVsc2UgaWYgKGFtb3VudCAmJiBkYXRlKSBjb25maWRlbmNlID0gMC45O1xyXG4gIGVsc2UgaWYgKGFtb3VudCkgY29uZmlkZW5jZSA9IDAuNztcclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIHBhcnNlZDoge1xyXG4gICAgICBhbW91bnQsXHJcbiAgICAgIGN1cnJlbmN5LFxyXG4gICAgICB2ZW5kb3IsXHJcbiAgICAgIGRhdGUsXHJcbiAgICAgIHJlZmVyZW5jZUlkXHJcbiAgICB9LFxyXG4gICAgY29uZmlkZW5jZVxyXG4gIH07XHJcbn1cclxuIl0sIm5hbWVzIjpbImFtb3VudFJlZ2V4IiwiY3VycmVuY3lSZWdleCIsImRhdGVSZWdleCIsIm5vcm1hbGl6ZUFtb3VudCIsInJhdyIsImNsZWFuZWQiLCJyZXBsYWNlIiwidW5kZWZpbmVkIiwiaW5jbHVkZXMiLCJsYXN0RG90IiwibGFzdEluZGV4T2YiLCJsYXN0Q29tbWEiLCJkZWNpbWFsU2VwIiwidGhvdXNhbmRzU2VwIiwibm9UaG91c2FuZHMiLCJSZWdFeHAiLCJub3JtYWxpemVkIiwidmFsdWUiLCJOdW1iZXIiLCJpc0Zpbml0ZSIsInBhcnNlRGF0ZSIsInRyaW1tZWQiLCJ0cmltIiwidGVzdCIsImQiLCJEYXRlIiwiaXNOYU4iLCJnZXRUaW1lIiwidG9JU09TdHJpbmciLCJhU3RyIiwiYlN0ciIsImNTdHIiLCJzcGxpdCIsImEiLCJiIiwiYyIsImRheSIsIm1vbnRoIiwiVVRDIiwiZXh0cmFjdFZlbmRvciIsInRleHQiLCJhdE1hdGNoIiwibWF0Y2giLCJmcm9tTWF0Y2giLCJ0b01hdGNoIiwibGluZU1hdGNoIiwiZmluZCIsImxpbmUiLCJjYW5kaWRhdGUiLCJsZW5ndGgiLCJleHRyYWN0UmVmZXJlbmNlSWQiLCJyZWZNYXRjaCIsInJlZ2V4UGFyc2VUcmFuc2FjdGlvbiIsImFtb3VudE1hdGNoIiwiY3VycmVuY3lNYXRjaCIsImRhdGVNYXRjaCIsImFtb3VudCIsImN1cnJlbmN5UmF3IiwidG9VcHBlckNhc2UiLCJjdXJyZW5jeSIsImRhdGUiLCJ2ZW5kb3IiLCJyZWZlcmVuY2VJZCIsImNvbmZpZGVuY2UiLCJwYXJzZWQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/parsing/transactionParser.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/rulesEngine.ts":
/*!********************************!*\
  !*** ./src/lib/rulesEngine.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   inferCategoryFromRules: () => (/* binding */ inferCategoryFromRules)\n/* harmony export */ });\n/* harmony import */ var _supabaseServer__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./supabaseServer */ \"(rsc)/./src/lib/supabaseServer.ts\");\n\nasync function inferCategoryFromRules(userId, vendor, rawText) {\n    const { data: rules, error } = await _supabaseServer__WEBPACK_IMPORTED_MODULE_0__.supabaseServer.from(\"rules\").select(\"pattern, category, enabled\").eq(\"user_id\", userId).eq(\"enabled\", true);\n    if (error || !rules || rules.length === 0) {\n        return null;\n    }\n    const haystack = `${vendor ?? \"\"} ${rawText}`.toLowerCase();\n    for (const rule of rules){\n        const pattern = (rule.pattern ?? \"\").toLowerCase();\n        if (!pattern) continue;\n        if (haystack.includes(pattern)) {\n            return rule.category ?? null;\n        }\n    }\n    return null;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3J1bGVzRW5naW5lLnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQWtEO0FBRTNDLGVBQWVDLHVCQUNwQkMsTUFBYyxFQUNkQyxNQUFxQixFQUNyQkMsT0FBZTtJQUVmLE1BQU0sRUFBRUMsTUFBTUMsS0FBSyxFQUFFQyxLQUFLLEVBQUUsR0FBRyxNQUFNUCwyREFBY0EsQ0FDaERRLElBQUksQ0FBQyxTQUNMQyxNQUFNLENBQUMsOEJBQ1BDLEVBQUUsQ0FBQyxXQUFXUixRQUNkUSxFQUFFLENBQUMsV0FBVztJQUVqQixJQUFJSCxTQUFTLENBQUNELFNBQVNBLE1BQU1LLE1BQU0sS0FBSyxHQUFHO1FBQ3pDLE9BQU87SUFDVDtJQUVBLE1BQU1DLFdBQVcsQ0FBQyxFQUFFVCxVQUFVLEdBQUcsQ0FBQyxFQUFFQyxRQUFRLENBQUMsQ0FBQ1MsV0FBVztJQUV6RCxLQUFLLE1BQU1DLFFBQVFSLE1BQU87UUFDeEIsTUFBTVMsVUFBVSxDQUFDRCxLQUFLQyxPQUFPLElBQUksRUFBQyxFQUFHRixXQUFXO1FBQ2hELElBQUksQ0FBQ0UsU0FBUztRQUNkLElBQUlILFNBQVNJLFFBQVEsQ0FBQ0QsVUFBVTtZQUM5QixPQUFPRCxLQUFLRyxRQUFRLElBQUk7UUFDMUI7SUFDRjtJQUVBLE9BQU87QUFDVCIsInNvdXJjZXMiOlsid2VicGFjazovL2V4cGVuc2UtdHJhY2tlci8uL3NyYy9saWIvcnVsZXNFbmdpbmUudHM/NmRmMyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBzdXBhYmFzZVNlcnZlciB9IGZyb20gXCIuL3N1cGFiYXNlU2VydmVyXCI7XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaW5mZXJDYXRlZ29yeUZyb21SdWxlcyhcclxuICB1c2VySWQ6IHN0cmluZyxcclxuICB2ZW5kb3I6IHN0cmluZyB8IG51bGwsXHJcbiAgcmF3VGV4dDogc3RyaW5nXHJcbik6IFByb21pc2U8c3RyaW5nIHwgbnVsbD4ge1xyXG4gIGNvbnN0IHsgZGF0YTogcnVsZXMsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVNlcnZlclxyXG4gICAgLmZyb20oXCJydWxlc1wiKVxyXG4gICAgLnNlbGVjdChcInBhdHRlcm4sIGNhdGVnb3J5LCBlbmFibGVkXCIpXHJcbiAgICAuZXEoXCJ1c2VyX2lkXCIsIHVzZXJJZClcclxuICAgIC5lcShcImVuYWJsZWRcIiwgdHJ1ZSk7XHJcblxyXG4gIGlmIChlcnJvciB8fCAhcnVsZXMgfHwgcnVsZXMubGVuZ3RoID09PSAwKSB7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcblxyXG4gIGNvbnN0IGhheXN0YWNrID0gYCR7dmVuZG9yID8/IFwiXCJ9ICR7cmF3VGV4dH1gLnRvTG93ZXJDYXNlKCk7XHJcblxyXG4gIGZvciAoY29uc3QgcnVsZSBvZiBydWxlcykge1xyXG4gICAgY29uc3QgcGF0dGVybiA9IChydWxlLnBhdHRlcm4gPz8gXCJcIikudG9Mb3dlckNhc2UoKTtcclxuICAgIGlmICghcGF0dGVybikgY29udGludWU7XHJcbiAgICBpZiAoaGF5c3RhY2suaW5jbHVkZXMocGF0dGVybikpIHtcclxuICAgICAgcmV0dXJuIHJ1bGUuY2F0ZWdvcnkgPz8gbnVsbDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJldHVybiBudWxsO1xyXG59XHJcbiJdLCJuYW1lcyI6WyJzdXBhYmFzZVNlcnZlciIsImluZmVyQ2F0ZWdvcnlGcm9tUnVsZXMiLCJ1c2VySWQiLCJ2ZW5kb3IiLCJyYXdUZXh0IiwiZGF0YSIsInJ1bGVzIiwiZXJyb3IiLCJmcm9tIiwic2VsZWN0IiwiZXEiLCJsZW5ndGgiLCJoYXlzdGFjayIsInRvTG93ZXJDYXNlIiwicnVsZSIsInBhdHRlcm4iLCJpbmNsdWRlcyIsImNhdGVnb3J5Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/rulesEngine.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/supabaseServer.ts":
/*!***********************************!*\
  !*** ./src/lib/supabaseServer.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   supabaseServer: () => (/* binding */ supabaseServer)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n\nconst supabaseUrl = \"https://eaunposkvqyszpnwwbrc.supabase.co\";\nconst serviceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\nif (!supabaseUrl || !serviceRoleKey) {\n    throw new Error(\"Supabase server env vars are not set\");\n}\nconst supabaseServer = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, serviceRoleKey, {\n    auth: {\n        autoRefreshToken: false,\n        persistSession: false\n    }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3N1cGFiYXNlU2VydmVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQXFEO0FBRXJELE1BQU1DLGNBQWNDLDBDQUFvQztBQUN4RCxNQUFNRyxpQkFBaUJILFFBQVFDLEdBQUcsQ0FBQ0cseUJBQXlCO0FBRTVELElBQUksQ0FBQ0wsZUFBZSxDQUFDSSxnQkFBZ0I7SUFDbkMsTUFBTSxJQUFJRSxNQUFNO0FBQ2xCO0FBRU8sTUFBTUMsaUJBQWlCUixtRUFBWUEsQ0FBQ0MsYUFBYUksZ0JBQWdCO0lBQ3RFSSxNQUFNO1FBQ0pDLGtCQUFrQjtRQUNsQkMsZ0JBQWdCO0lBQ2xCO0FBQ0YsR0FBRyIsInNvdXJjZXMiOlsid2VicGFjazovL2V4cGVuc2UtdHJhY2tlci8uL3NyYy9saWIvc3VwYWJhc2VTZXJ2ZXIudHM/MWIzMiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tIFwiQHN1cGFiYXNlL3N1cGFiYXNlLWpzXCI7XHJcblxyXG5jb25zdCBzdXBhYmFzZVVybCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCBhcyBzdHJpbmc7XHJcbmNvbnN0IHNlcnZpY2VSb2xlS2V5ID0gcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSBhcyBzdHJpbmc7XHJcblxyXG5pZiAoIXN1cGFiYXNlVXJsIHx8ICFzZXJ2aWNlUm9sZUtleSkge1xyXG4gIHRocm93IG5ldyBFcnJvcihcIlN1cGFiYXNlIHNlcnZlciBlbnYgdmFycyBhcmUgbm90IHNldFwiKTtcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IHN1cGFiYXNlU2VydmVyID0gY3JlYXRlQ2xpZW50KHN1cGFiYXNlVXJsLCBzZXJ2aWNlUm9sZUtleSwge1xyXG4gIGF1dGg6IHtcclxuICAgIGF1dG9SZWZyZXNoVG9rZW46IGZhbHNlLFxyXG4gICAgcGVyc2lzdFNlc3Npb246IGZhbHNlXHJcbiAgfVxyXG59KTtcclxuIl0sIm5hbWVzIjpbImNyZWF0ZUNsaWVudCIsInN1cGFiYXNlVXJsIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsInNlcnZpY2VSb2xlS2V5IiwiU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSIsIkVycm9yIiwic3VwYWJhc2VTZXJ2ZXIiLCJhdXRoIiwiYXV0b1JlZnJlc2hUb2tlbiIsInBlcnNpc3RTZXNzaW9uIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/supabaseServer.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@supabase","vendor-chunks/tslib"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fgmail%2Fsync%2Froute&page=%2Fapi%2Fgmail%2Fsync%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fgmail%2Fsync%2Froute.ts&appDir=C%3A%5CUsers%5CEmmanuel%5CDesktop%5CExpense%20Tracker%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CEmmanuel%5CDesktop%5CExpense%20Tracker&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();